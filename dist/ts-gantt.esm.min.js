class t{}function e(t,e=[],s=[],i=null,n=null){const a=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of s)a.setAttribute(t[0],t[1]);return 0!==e.length&&a.classList.add(...e),n&&(a.innerHTML=n),i&&i.append(a),a}t.CSS_VAR_SEPARATOR_WIDTH="--tsg-separator-width",t.CSS_VAR_HEADER_HEIGHT="--tsg-header-height",t.CSS_VAR_ROW_HEIGHT="--tsg-row-height",t.CSS_VAR_GRIDLINES_WIDTH="--tsg-gridlines-width",t.CSS_VAR_BAR_STROKE_WIDTH="--tsg-bar-stroke-width",t.TEXT_SELECTION_DISABLED="tsg-no-text-selection",t.WRAPPER_CLASS="tsg-wrapper",t.FOOTER_CLASS="tsg-footer",t.SEPARATOR_CLASS="tsg-separator",t.ROW_SELECTED_CLASS="selected",t.ROW_OVERDUE_CLASS="overdue",t.ROW_CLICK_EVENT="tsgrowclick",t.ROW_CONTEXT_MENU_EVENT="tsgrowcontextmenu",t.TABLE_WRAPPER_CLASS="tsg-table-wrapper",t.TABLE_CLASS="tsg-table",t.TABLE_COLUMN_RESIZER_CLASS="tsg-table-col-resizer",t.TABLE_HEADER_CLASS="tsg-table-header",t.TABLE_BODY_ROW_CLASS="tsg-table-body-row",t.TABLE_BODY_CELL_CLASS="tsg-table-body-cell",t.TABLE_BODY_CELL_TEXT_WRAPPER_CLASS="tsg-table-body-cell-text-wrapper",t.TABLE_BODY_CELL_TEXT_CLASS="tsg-table-body-cell-text",t.TABLE_BODY_CELL_EXPANDER_CLASS="tsg-table-body-cell-text-expander",t.TABLE_BODY_CELL_EXPANDER_NESTING_PREFIX="nesting-",t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT="tsgexpanderclick",t.CHART_WRAPPER_CLASS="tsg-chart-wrapper",t.CHART_CLASS="tsg-chart",t.CHART_HEADER_CLASS="tsg-chart-header",t.CHART_HEADER_BACKGROUND_CLASS="tsg-chart-header-bg",t.CHART_HEADER_GRIDLINES_CLASS="tsg-chart-header-gl",t.CHART_HEADER_TEXT_CLASS="tsg-chart-header-text",t.CHART_BODY_CLASS="tsg-chart-body",t.CHART_BODY_BACKGROUND_CLASS="tsg-chart-body-bg",t.CHART_BODY_GRIDLINES_CLASS="tsg-chart-body-gl",t.CHART_BODY_TODAY_LINE_CLASS="tsg-chart-body-gl-today",t.CHART_ROW_WRAPPER_CLASS="tsg-chart-row-wrapper",t.CHART_ROW_CLASS="tsg-chart-row",t.CHART_ROW_BACKGROUND_CLASS="tsg-chart-row-bg",t.CHART_BAR_GROUP_CLASS="tsg-chart-bar-group",t.CHART_BAR_WRAPPER_CLASS="tsg-chart-bar-wrapper",t.CHART_BAR_PLANNED_CLASS="tsg-chart-bar-planned",t.CHART_BAR_PLANNED_PROGRESS_CLASS="tsg-chart-bar-planned-progress",t.CHART_BAR_ACTUAL_CLASS="tsg-chart-bar-actual",t.CHART_BAR_ACTUAL_PROGRESS_CLASS="tsg-chart-bar-actual-progress";class s{constructor(t=null){this.multilineSelection=!0,this.useCtrlKeyForMultilineSelection=!0,this.drawTodayLine=!0,this.highlightRowsDependingOnTaskState=!0,this.columnsMinWidthPx=[200,100,100,100,100,100,100,100],this.columnsContentAlign=["start","end","center","center","center","center","center","center"],this.separatorWidthPx=5,this.headerHeightPx=90,this.rowHeightPx=40,this.borderWidthPx=1,this.barStrokeWidthPx=2,this.barMarginPx=2,this.barCornerRadiusPx=6,this.rowSymbols={childless:"•",collapsed:"▾",expanded:"▴"},this.chartShowProgress=!0,this.chartDisplayMode="both",this.chartScale="month",this.chartDateOffsetDays={day:14,week:60,month:240,year:730},this.chartDateOffsetDaysMin={day:7,week:30,month:120,year:365},this.chartDayWidthPx={day:60,week:20,month:3,year:1},this.locale="en",this.localeDecimalSeparator={en:".",uk:",",ru:",",ja:"."},this.localeDateFormat={en:"MM/DD/YYYY",uk:"DD.MM.YYYY",ru:"DD.MM.YYYY",ja:"YYYY/MM/DD"},this.localeFirstWeekDay={en:0,uk:1,ru:1,ja:0},this.localeDateMonths={en:["January","February","March","April","May","June","July","August","September","October","November","December"],uk:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],ja:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},this.localeDateDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],uk:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"],ru:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],ja:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"]},this.localeDateDaysShort={en:["Su","Mo","Tu","We","Th","Fr","Sa"],uk:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],ru:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],ja:["日","月","火","水","木","金","土"]},this.localeDateScale={en:["Weeks","Months","Years"],uk:["Тижні","Місяці","Роки"],ru:["Недели","Месяцы","Годы"],ja:["週間","月間","年間"]},this.localeFooters={en:["Total tasks","Completed"],uk:["Всього задач","Завершено"],ru:["Всего задач","Завершено"],ja:["総タスク","完了"]},this.localeHeaders={en:["Name","Progress","Start date planned","End date planned","Start date actual","End date actual","Duration planned","Duration actual"],uk:["Ім'я","Прогрес","Дата початку планована","Дата завершення планована","Дата початку фактична","Дата завершення фактична","Тривалість планована","Тривалість фактична"],ru:["Имя","Прогресс","Дата начала планируемая","Дата окончания планируемая","Дата начала фактическая","Дата окончания фактическая","Длительность планируемая","Длительность фактическая"],ja:["タイトル","進捗","予定開始日","予定終了日","実績開始日","実績終了日","予定日数","実績日数"]},this.localeDurationFormatters={en:t=>1===t?"1 day":t+" days",uk:t=>{let e=t%100;return e>10&&e<20?t+" днів":(e%=10,1===e?t+" день":e<5&&e>0?t+" дні":t+" днів")},ru:t=>{let e=t%100;return e>10&&e<20?t+" дней":(e%=10,1===e?t+" день":e<5&&e>0?t+" дня":t+" дней")},ja:t=>1===t?"1 日":t+" 日間"},this.columnValueGetters=[t=>t.localizedNames&&t.localizedNames[this.locale]||t.name,t=>(+t.progress.toFixed(2)).toLocaleString("en-US").replace(".",this.localeDecimalSeparator[this.locale]||".")+" %",t=>t.datePlannedStart?t.datePlannedStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.datePlannedEnd?t.datePlannedEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualStart?t.dateActualStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualEnd?t.dateActualEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>{if(!t.datePlannedEnd||!t.datePlannedStart)return"";const e=t.datePlannedEnd,s=t.datePlannedStart,i=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](i):i.toString()},t=>{if(!t.dateActualEnd||!t.dateActualStart)return"";const e=t.dateActualEnd,s=t.dateActualStart,i=e.diff(s,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](i):i.toString()}],null!=t&&Object.assign(this,t)}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var i={exports:{}},n=i.exports=function(){var t=1e3,e=6e4,s=36e5,i="millisecond",n="second",a="minute",r="hour",o="day",d="week",h="month",l="quarter",c="year",u="date",_="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,E={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},A=function(t,e,s){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(s)+t},m={s:A,z:function(t){var e=-t.utcOffset(),s=Math.abs(e),i=Math.floor(s/60),n=s%60;return(e<=0?"+":"-")+A(i,2,"0")+":"+A(n,2,"0")},m:function t(e,s){if(e.date()<s.date())return-t(s,e);var i=12*(s.year()-e.year())+(s.month()-e.month()),n=e.clone().add(i,h),a=s-n<0,r=e.clone().add(i+(a?-1:1),h);return+(-(i+(s-n)/(a?n-r:r-n))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:h,y:c,w:d,d:o,D:u,h:r,m:a,s:n,ms:i,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},f="en",C={};C[f]=E;var g=function(t){return t instanceof T},L=function t(e,s,i){var n;if(!e)return f;if("string"==typeof e){var a=e.toLowerCase();C[a]&&(n=a),s&&(C[a]=s,n=a);var r=e.split("-");if(!n&&r.length>1)return t(r[0])}else{var o=e.name;C[o]=e,n=o}return!i&&n&&(f=n),n||!i&&f},R=function(t,e){if(g(t))return t.clone();var s="object"==typeof e?e:{};return s.date=t,s.args=arguments,new T(s)},v=m;v.l=L,v.i=g,v.w=function(t,e){return R(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var T=function(){function E(t){this.$L=L(t.locale,null,!0),this.parse(t)}var A=E.prototype;return A.parse=function(t){this.$d=function(t){var e=t.date,s=t.utc;if(null===e)return new Date(NaN);if(v.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(p);if(i){var n=i[2]-1||0,a=(i[7]||"0").substring(0,3);return s?new Date(Date.UTC(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)):new Date(i[1],n,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},A.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},A.$utils=function(){return v},A.isValid=function(){return!(this.$d.toString()===_)},A.isSame=function(t,e){var s=R(t);return this.startOf(e)<=s&&s<=this.endOf(e)},A.isAfter=function(t,e){return R(t)<this.startOf(e)},A.isBefore=function(t,e){return this.endOf(e)<R(t)},A.$g=function(t,e,s){return v.u(t)?this[e]:this.set(s,t)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(t,e){var s=this,i=!!v.u(e)||e,l=v.p(t),_=function(t,e){var n=v.w(s.$u?Date.UTC(s.$y,e,t):new Date(s.$y,e,t),s);return i?n:n.endOf(o)},p=function(t,e){return v.w(s.toDate()[t].apply(s.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(e)),s)},S=this.$W,E=this.$M,A=this.$D,m="set"+(this.$u?"UTC":"");switch(l){case c:return i?_(1,0):_(31,11);case h:return i?_(1,E):_(0,E+1);case d:var f=this.$locale().weekStart||0,C=(S<f?S+7:S)-f;return _(i?A-C:A+(6-C),E);case o:case u:return p(m+"Hours",0);case r:return p(m+"Minutes",1);case a:return p(m+"Seconds",2);case n:return p(m+"Milliseconds",3);default:return this.clone()}},A.endOf=function(t){return this.startOf(t,!1)},A.$set=function(t,e){var s,d=v.p(t),l="set"+(this.$u?"UTC":""),_=(s={},s[o]=l+"Date",s[u]=l+"Date",s[h]=l+"Month",s[c]=l+"FullYear",s[r]=l+"Hours",s[a]=l+"Minutes",s[n]=l+"Seconds",s[i]=l+"Milliseconds",s)[d],p=d===o?this.$D+(e-this.$W):e;if(d===h||d===c){var S=this.clone().set(u,1);S.$d[_](p),S.init(),this.$d=S.set(u,Math.min(this.$D,S.daysInMonth())).$d}else _&&this.$d[_](p);return this.init(),this},A.set=function(t,e){return this.clone().$set(t,e)},A.get=function(t){return this[v.p(t)]()},A.add=function(i,l){var u,_=this;i=Number(i);var p=v.p(l),S=function(t){var e=R(_);return v.w(e.date(e.date()+Math.round(t*i)),_)};if(p===h)return this.set(h,this.$M+i);if(p===c)return this.set(c,this.$y+i);if(p===o)return S(1);if(p===d)return S(7);var E=(u={},u[a]=e,u[r]=s,u[n]=t,u)[p]||1,A=this.$d.getTime()+i*E;return v.w(A,this)},A.subtract=function(t,e){return this.add(-1*t,e)},A.format=function(t){var e=this,s=this.$locale();if(!this.isValid())return s.invalidDate||_;var i=t||"YYYY-MM-DDTHH:mm:ssZ",n=v.z(this),a=this.$H,r=this.$m,o=this.$M,d=s.weekdays,h=s.months,l=function(t,s,n,a){return t&&(t[s]||t(e,i))||n[s].slice(0,a)},c=function(t){return v.s(a%12||12,t,"0")},u=s.meridiem||function(t,e,s){var i=t<12?"AM":"PM";return s?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:v.s(o+1,2,"0"),MMM:l(s.monthsShort,o,h,3),MMMM:l(h,o),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:l(s.weekdaysMin,this.$W,d,2),ddd:l(s.weekdaysShort,this.$W,d,3),dddd:d[this.$W],H:String(a),HH:v.s(a,2,"0"),h:c(1),hh:c(2),a:u(a,r,!0),A:u(a,r,!1),m:String(r),mm:v.s(r,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:n};return i.replace(S,(function(t,e){return e||p[t]||n.replace(":","")}))},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(i,u,_){var p,S=v.p(u),E=R(i),A=(E.utcOffset()-this.utcOffset())*e,m=this-E,f=v.m(this,E);return f=(p={},p[c]=f/12,p[h]=f,p[l]=f/3,p[d]=(m-A)/6048e5,p[o]=(m-A)/864e5,p[r]=m/s,p[a]=m/e,p[n]=m/t,p)[S]||m,_?f:v.a(f)},A.daysInMonth=function(){return this.endOf(h).$D},A.$locale=function(){return C[this.$L]},A.locale=function(t,e){if(!t)return this.$L;var s=this.clone(),i=L(t,e,!0);return i&&(s.$L=i),s},A.clone=function(){return v.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},E}(),y=T.prototype;return R.prototype=y,[["$ms",i],["$s",n],["$m",a],["$H",r],["$W",o],["$M",h],["$y",c],["$D",u]].forEach((function(t){y[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),R.extend=function(t,e){return t.$i||(t(e,T,R),t.$i=!0),R},R.locale=L,R.isDayjs=g,R.unix=function(t){return R(1e3*t)},R.en=C[f],R.Ls=C,R.p={},R}();class a{constructor(t,e,s,i,a,r=null,o=null,d=null,h=null,l=0,c=!1,u=null,_=null){this.externalId=t,this.parentExternalId=e,this.name=s,this.localizedNames=i,this.progress=a<0?0:a>100?100:a,this.datePlannedStart=r?n(r):null,this.datePlannedEnd=o?n(o):null,this.dateActualStart=d?n(d):null,this.dateActualEnd=h?n(h):null,this.nestingLvl=l,this.hasChildren=c,this.parentUuid=u,this.uuid=_||crypto.getRandomValues(new Uint32Array(4)).join("-"),this.expanded=!1}static convertModelsToTasks(t,e=new Map){const s=t.slice(),i=new Set(s.map((t=>t.parentId))),n=[];let r=[];for(let t=s.length-1;t>=0;t--){const o=s[t];if(!o.parentId){const d=new a(o.id,o.parentId,o.name,o.localizedNames,o.progress,o.datePlannedStart,o.datePlannedEnd,o.dateActualStart,o.dateActualEnd,0,i.has(o.id),null,e.get(o.id));n.push(d),r.push(d),s.splice(t,1)}}let o=1;for(;0!==r.length;){const t=[];r.filter((t=>t.hasChildren)).forEach((r=>{for(let d=s.length-1;d>=0;d--){const h=s[d];if(h.parentId===r.externalId){const l=new a(h.id,h.parentId,h.name,h.localizedNames,h.progress,h.datePlannedStart,h.datePlannedEnd,h.dateActualStart,h.dateActualEnd,o,i.has(h.id),r.uuid,e.get(h.id));n.push(l),t.push(l),s.splice(d,1)}}})),r=t,o++}return n}static detectTaskChanges(t){const{oldTasks:e,newTasks:s}=t,i=e.map((t=>t.uuid)),n=s.map((t=>t.uuid)),a=e.filter((t=>!n.includes(t.uuid))),r=[],o=[],d=[];for(const t of s){if(!i.includes(t.uuid)){r.push(t),d.push(t);continue}const s=e.find((e=>e.uuid===t.uuid));t.equals(s)?d.push(s):(o.push(t),d.push(t))}return{deleted:a,added:r,changed:o,all:d}}static createTasksIdMap(t){const e=new Map;for(const s of t)e.has(s.externalId)||e.set(s.externalId,s.uuid);return e}static checkPaternity(t,e,s){var i;let n=s.parentUuid;for(;n;){if(n===e.uuid)return!0;n=null===(i=t.find((t=>t.uuid===n)))||void 0===i?void 0:i.parentUuid}return!1}static checkForCollapsedParent(t,e){for(;e.parentUuid;)if(!(e=t.find((t=>t.uuid===e.parentUuid))).expanded)return!0;return!1}static sortTasksRecursively(t,e){const s=t.filter((t=>t.parentUuid===e)).sort(a.defaultComparer),i=[];for(const e of s)i.push(e),i.push(...this.sortTasksRecursively(t,e.uuid));return i}equals(t){var e,s,i,n,a,r,o,d;return this.externalId===t.externalId&&this.parentExternalId===t.parentExternalId&&this.nestingLvl===t.nestingLvl&&this.hasChildren===t.hasChildren&&this.name===t.name&&this.progress===t.progress&&(null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())===(null===(s=t.datePlannedStart)||void 0===s?void 0:s.unix())&&(null===(i=this.datePlannedEnd)||void 0===i?void 0:i.unix())===(null===(n=t.datePlannedEnd)||void 0===n?void 0:n.unix())&&(null===(a=this.dateActualStart)||void 0===a?void 0:a.unix())===(null===(r=t.dateActualStart)||void 0===r?void 0:r.unix())&&(null===(o=this.dateActualEnd)||void 0===o?void 0:o.unix())===(null===(d=t.dateActualEnd)||void 0===d?void 0:d.unix())}compareTo(t){var e,s,i,n,a,r,o,d,h,l,c,u,_,p,S,E;return this.nestingLvl>t.nestingLvl?1:this.nestingLvl<t.nestingLvl?-1:((null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())||0)>((null===(s=t.datePlannedStart)||void 0===s?void 0:s.unix())||0)?1:((null===(i=this.datePlannedStart)||void 0===i?void 0:i.unix())||0)<(null===(n=t.datePlannedStart)||void 0===n?void 0:n.unix())?-1:((null===(a=this.datePlannedEnd)||void 0===a?void 0:a.unix())||0)>((null===(r=t.datePlannedEnd)||void 0===r?void 0:r.unix())||0)?1:((null===(o=this.datePlannedEnd)||void 0===o?void 0:o.unix())||0)<((null===(d=t.datePlannedEnd)||void 0===d?void 0:d.unix())||0)?-1:((null===(h=this.dateActualStart)||void 0===h?void 0:h.unix())||0)>((null===(l=t.dateActualStart)||void 0===l?void 0:l.unix())||0)?1:((null===(c=this.dateActualStart)||void 0===c?void 0:c.unix())||0)<((null===(u=t.dateActualStart)||void 0===u?void 0:u.unix())||0)?-1:((null===(_=this.dateActualEnd)||void 0===_?void 0:_.unix())||0)>((null===(p=t.dateActualEnd)||void 0===p?void 0:p.unix())||0)?1:((null===(S=this.dateActualEnd)||void 0===S?void 0:S.unix())||0)<((null===(E=t.dateActualEnd)||void 0===E?void 0:E.unix())||0)?-1:this.name.localeCompare(t.name)}getState(){return 0===this.progress?"not-started":100===this.progress?this.datePlannedEnd&&(this.dateActualEnd&&this.dateActualEnd.isAfter(this.datePlannedEnd)||this.dateActualStart&&this.dateActualStart.isAfter(this.datePlannedEnd))?"completed-late":"completed":this.datePlannedEnd&&this.datePlannedEnd.isBefore(n().startOf("day"))?"overdue":"in-progress"}toModel(){var t,e,s,i;return{id:this.externalId,parentId:this.parentExternalId,name:this.name,progress:this.progress,datePlannedStart:(null===(t=this.datePlannedStart)||void 0===t?void 0:t.toDate())||null,datePlannedEnd:(null===(e=this.datePlannedEnd)||void 0===e?void 0:e.toDate())||null,dateActualStart:(null===(s=this.dateActualStart)||void 0===s?void 0:s.toDate())||null,dateActualEnd:(null===(i=this.dateActualEnd)||void 0===i?void 0:i.toDate())||null,localizedNames:this.localizedNames}}}a.defaultComparer=(t,e)=>t.compareTo(e);class r{constructor(t,e,s,i){this._dragActive=!1,this.onMouseDownOnResizer=t=>{document.addEventListener("mousemove",this.onMouseMoveWhileResizing),document.addEventListener("mouseup",this.onMouseUpWhileResizing),document.addEventListener("touchmove",this.onMouseMoveWhileResizing,{passive:!1}),document.addEventListener("touchend",this.onMouseUpWhileResizing),this._dragActive=!0},this.onMouseMoveWhileResizing=t=>{if(!this._dragActive)return!1;const e=this.html.getBoundingClientRect().left,s=t instanceof MouseEvent?t.clientX-e:t.touches[0].clientX-e;this.html.style.width=Math.max(this.minWidth,s)+"px",t.preventDefault()},this.onMouseUpWhileResizing=t=>{document.removeEventListener("mousemove",this.onMouseMoveWhileResizing),document.removeEventListener("mouseup",this.onMouseUpWhileResizing),document.removeEventListener("touchmove",this.onMouseMoveWhileResizing,{passive:!1}),document.removeEventListener("touchend",this.onMouseUpWhileResizing),this._dragActive=!1},this.minWidth=t,this.contentAlign=e,this.header=s,this.valueGetter=i,this.html=this.createHeader(),this.resizer=this.createResizer(),this.resizer.addEventListener("mousedown",this.onMouseDownOnResizer),this.resizer.addEventListener("touchstart",this.onMouseDownOnResizer),this.html.append(this.resizer)}createHeader(){const e=document.createElement("th");return e.classList.add(t.TABLE_HEADER_CLASS),e.style.minWidth=this.minWidth+"px",e.style.width=this.minWidth+"px",e.innerHTML=this.header,e}createResizer(){const e=document.createElement("div");return e.classList.add(t.TABLE_COLUMN_RESIZER_CLASS),e}}class o{constructor(t,e,s){this.task=t,this.expander=this.createExpander(),this.html=this.createRow(e,s)}createRow(e,s){const i=document.createElement("tr");return i.classList.add(t.TABLE_BODY_ROW_CLASS),i.addEventListener("click",(e=>{e.target.classList.contains(t.TABLE_BODY_CELL_EXPANDER_CLASS)||i.dispatchEvent(new CustomEvent(t.ROW_CLICK_EVENT,{bubbles:!0,detail:{task:this.task,event:e}}))})),i.addEventListener("contextmenu",(e=>{e.target.classList.contains(t.TABLE_BODY_CELL_EXPANDER_CLASS)||i.dispatchEvent(new CustomEvent(t.ROW_CONTEXT_MENU_EVENT,{bubbles:!0,detail:{task:this.task,event:e}}))})),s&&i.classList.add(this.task.getState()),e.forEach(((e,s)=>{const n=document.createElement("td");n.classList.add(t.TABLE_BODY_CELL_CLASS);const a=document.createElement("div");a.classList.add(t.TABLE_BODY_CELL_TEXT_WRAPPER_CLASS,e.contentAlign),0===s&&a.append(this.expander);const r=document.createElement("p");r.classList.add(t.TABLE_BODY_CELL_TEXT_CLASS),r.innerHTML=e.valueGetter(this.task),a.append(r),n.append(a),i.append(n)})),i}createExpander(){const e=document.createElement("p");e.classList.add(t.TABLE_BODY_CELL_EXPANDER_CLASS);const s=this.task.nestingLvl;return s&&e.classList.add(t.TABLE_BODY_CELL_EXPANDER_NESTING_PREFIX+(s<10?s:10)),this.task.hasChildren&&e.addEventListener("click",(s=>{e.dispatchEvent(new CustomEvent(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,{bubbles:!0,detail:{task:this.task,event:s}}))})),e}}class d{constructor(e){this._tableRows=new Map,this._activeUuids=[],this._options=e;const s=document.createElement("table");s.classList.add(t.TABLE_CLASS);const i=s.createTHead(),n=s.createTBody();this._htmlHead=i,this._htmlBody=n,this._html=s,this.updateColumns()}get html(){return this._html}update(t,e,s=null){t&&this.updateColumns(),e&&this.updateRows(e),s&&(this._activeUuids=s),this.redraw()}applySelection(e){const{selected:s,deselected:i}=e;for(const e of i){const s=this._tableRows.get(e);s&&s.html.classList.remove(t.ROW_SELECTED_CLASS)}for(const e of s){const s=this._tableRows.get(e);s&&s.html.classList.add(t.ROW_SELECTED_CLASS)}}updateColumns(){const t=[];for(let e=0;e<9;e++){const s=this._options.columnsMinWidthPx[e],i=this._options.columnsContentAlign[e];s&&t.push(new r(s,i,this._options.localeHeaders[this._options.locale][e]||"",this._options.columnValueGetters[e]||(t=>"")))}this._tableColumns=t}updateRows(t){const e=this._tableColumns,s=this._tableRows,i=this._options.highlightRowsDependingOnTaskState;t.deleted.forEach((t=>s.delete(t.uuid))),t.changed.forEach((t=>s.set(t.uuid,new o(t,e,i)))),t.added.forEach((t=>s.set(t.uuid,new o(t,e,i))))}redraw(){const t=document.createElement("tr");this._tableColumns.forEach((e=>t.append(e.html))),this._htmlHead.innerHTML="",this._htmlHead.append(t),this._htmlBody.innerHTML="",this._htmlBody.append(...this._activeUuids.map((t=>this.getRowHtml(t))))}getRowHtml(t){const e=this._options.rowSymbols,s=this._tableRows.get(t);return s.task.hasChildren?s.task.expanded?s.expander.innerHTML=e.expanded:s.expander.innerHTML=e.collapsed:s.expander.innerHTML=e.childless,s.html}}class h{constructor(t,e){const{mode:s,showProgress:i,dayWidth:n,rowHeight:a,barMinWidth:r,barHeight:o,barBorder:d,barCornerR:h,y0:l,y1:c}=e,{datePlannedStart:u,datePlannedEnd:_,dateActualStart:p,dateActualEnd:S}=t,E=u&&_,A=p&&S;let m,f,C;"both"===s?(A||E)&&(A&&E?(m=u.isBefore(p)?u:p,f=_.isAfter(S)?_:S):E?(m=u,f=_):(m=p,f=S),C=this.createSvg(m,f,n,r,a),E&&this.createBar(C,m,u,_,n,r,o,l,d,h,"planned",t.progress,i),A&&this.createBar(C,m,p,S,n,r,o,c,d,h,"actual",t.progress,i)):"planned"===s&&E?(m=u,f=_,C=this.createSvg(m,f,n,r,a),this.createBar(C,m,m,f,n,r,o,l,d,h,"planned",t.progress,i)):"actual"===s&&A&&(m=p,f=S,C=this.createSvg(m,f,n,r,a),this.createBar(C,m,m,f,n,r,o,l,d,h,"actual",t.progress,i)),this.minDate=m,this.maxDate=f,this.barSvg=C,this.task=t}createSvg(s,i,n,a,r){const o=i.diff(s,"day")+1,d=Math.max(o*n+a,a);return e("svg",[t.CHART_BAR_GROUP_CLASS],[["width",d+""],["height",r+""]])}createBar(s,i,n,a,r,o,d,h,l,c,u,_,p){const S="planned"===u?[t.CHART_BAR_PLANNED_CLASS]:[t.CHART_BAR_ACTUAL_CLASS],E="planned"===u?[t.CHART_BAR_PLANNED_PROGRESS_CLASS]:[t.CHART_BAR_ACTUAL_PROGRESS_CLASS],A=n.diff(i,"day")*r,m=a.diff(n,"day")+1,f=Math.max(m*r,o),C=e("svg",[t.CHART_BAR_WRAPPER_CLASS],[["x",A+""],["y",h+""],["width",f+""],["height",d+""]],s),g=l/2,L=f-l,R=d-l;if(e("rect",S,[["x",g+""],["y",g+""],["width",L+""],["height",R+""],["rx",c+""],["ry",c+""]],C),p){const t=L*_/100;e("rect",E,[["x",g+""],["y",g+""],["width",(t<o-l?0:t)+""],["height",R+""],["rx",c+""],["ry",c+""]],C)}}}class l{constructor(t){this._chartBarGroups=new Map,this._activeUuids=[],this._options=t,this._html=this.createChartDiv()}get html(){return this._html}get htmlHeader(){return this._htmlHeader}update(t,e,s=null){(!e||this.checkDates(e.all))&&!t||this.refreshHeader(),e&&this.refreshBarGroups(e),s&&(this._activeUuids=s),this.refreshBody(),this.redraw()}applySelection(e){const{selected:s,deselected:i}=e;for(const e of i){const s=this._chartRowBgs.get(e);s&&s.classList.remove(t.ROW_SELECTED_CLASS);const i=this._chartRowFgs.get(e);i&&i.classList.remove(t.ROW_SELECTED_CLASS)}for(const e of s){const s=this._chartRowBgs.get(e);s&&s.classList.add(t.ROW_SELECTED_CLASS);const i=this._chartRowFgs.get(e);i&&i.classList.add(t.ROW_SELECTED_CLASS)}}getBarOffsetByTaskUuid(t){return this._chartOffsetsX.get(t)}createChartDiv(){const e=document.createElement("div");return e.classList.add(t.CHART_CLASS),e}checkDates(t){const e=this._dateMinOffset,s=this._dateMaxOffset,i=this._options.chartScale,a=this._options.chartDateOffsetDaysMin[i],r=this._options.chartDateOffsetDays[i];let o=n(),d=n();for(const e of t){const t=n(e.datePlannedStart),s=n(e.datePlannedEnd),i=e.dateActualStart?n(e.dateActualStart):null,a=e.dateActualEnd?n(e.dateActualEnd):null;t.isBefore(o)&&(o=t),s.isAfter(d)&&(d=s),i&&i.isBefore(o)&&(o=i),a&&a.isAfter(d)&&(d=a)}return(!e||e.isAfter(o)||o.diff(e,"day")<a)&&(this._dateMinOffset=o.subtract(r,"day")),(!s||s.isBefore(d)||s.diff(d,"day")<a)&&(this._dateMaxOffset=d.add(r,"day")),this._dateMinOffset===e&&this._dateMaxOffset===s}getBarGroupOptions(){const t=this._options.chartDisplayMode,e=this._options.chartShowProgress,s=this._options.chartDayWidthPx[this._options.chartScale],i=this._options.rowHeightPx,n=this._options.borderWidthPx,a=this._options.barMarginPx,r=this._options.barStrokeWidthPx,o=this._options.barCornerRadiusPx,d=r+2*o,h=a-n/2;let l,c;switch(t){case"both":l=(i-3*a)/2,c=l+2*a-n/2;break;case"planned":case"actual":l=i-2*a}return{mode:t,showProgress:e,dayWidth:s,rowHeight:i,barMinWidth:d,barHeight:l,barBorder:r,barCornerR:o,y0:h,y1:c}}refreshBarGroups(t){const e=this.getBarGroupOptions();t.deleted.forEach((t=>this._chartBarGroups.delete(t.uuid))),t.changed.forEach((t=>this._chartBarGroups.set(t.uuid,new h(t,e)))),t.added.forEach((t=>this._chartBarGroups.set(t.uuid,new h(t,e))))}refreshHeader(){const s=this._options.chartScale,i=this._options.chartDayWidthPx[s],n=this._options.headerHeightPx;this._dateMinOffset;const a=this._dateMaxOffset,r=function(t,e){const s=t.startOf("day"),i=e.startOf("day");if(!s||!i||i.diff(s)<0)return[];if(0===i.diff(s))return[s];const n=[];let a=s;for(;a.isBefore(i)||a.isSame(i);)n.push(a),a=a.add(1,"day");return n}(this._dateMinOffset,this._dateMaxOffset),o=r.length*i,d=this._options.locale,h=this._options.localeDateMonths[d],l=this._options.localeDateDaysShort[d];this._options.localeDateDays[d];const c=e("svg",[t.CHART_HEADER_CLASS],[["width",o+""],["height",n+""]]);e("rect",[t.CHART_HEADER_BACKGROUND_CLASS],[["width",o+""],["height",n+""]],c);let u=0,_=0,p=0;const S=[];if("year"===s)for(const s of r){const r=u+i;if(s.isSame(s.endOf("year").startOf("day"))||s.isSame(a)){const i=r-p,a=e("svg",[],[["x",p+""],["y","0"],["width",i+""],["height",n+""]],c);i>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,s.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1","0"],["x2",r+""],["y2",n+""]],c),S.push(r),p=r}u=r}else if("month"===s){const s=n/2,d=0,l=s;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",l+""],["x2",o+""],["y2",l+""]],c);for(const o of r){const r=u+i;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(a)){const i=r-p,n=e("svg",[],[["x",p+""],["y",d+""],["width",i+""],["height",s+""]],c);i>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],n,o.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",d+""],["x2",r+""],["y2",l+""]],c),p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(a)){const i=r-_,a=e("svg",[],[["x",_+""],["y",l+""],["width",i+""],["height",s+""]],c);if(i>=60){const s=h[o.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,s)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",l+""],["x2",r+""],["y2",n+""]],c),S.push(r),_=r}u=r}}else if("week"===s||"day"===s){const s=n/3,d=0,E=s,A=2*s;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",E+""],["x2",o+""],["y2",E+""]],c),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",A+""],["x2",o+""],["y2",A+""]],c);for(const o of r){const r=u+i;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(a)){const i=r-p,n=e("svg",[],[["x",p+""],["y",d+""],["width",i+""],["height",s+""]],c);i>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],n,o.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",d+""],["x2",r+""],["y2",E+""]],c),p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(a)){const i=r-_,n=e("svg",[],[["x",_+""],["y",E+""],["width",i+""],["height",s+""]],c);if(i>=60){const s=h[o.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],n,s)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",E+""],["x2",r+""],["y2",A+""]],c),_=r}const m=e("svg",[],[["x",u+""],["y",A+""],["width",i+""],["height",s+""]],c),f=i<30?o.date()+"":l[o.day()]+" "+o.date();e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],m,f),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",A+""],["x2",r+""],["y2",n+""]],c),S.push(r),u=r}}this._width=o,this._headerHeight=n,this._verticalLinesXCoords=S,this._htmlHeader=c}refreshBody(){const s=this._options.chartScale,i=this._options.chartDayWidthPx[s],a=this._options.rowHeightPx,r=this._options.borderWidthPx,o=this._activeUuids.map((t=>this._chartBarGroups.get(t))),d=this._dateMinOffset,h=this._verticalLinesXCoords,l=this._width,c=a*o.length,u=this._headerHeight,_=this._options.drawTodayLine,p=e("svg",[t.CHART_BODY_CLASS],[["y",u+""],["width",l+""],["height",c+""]]);e("rect",[t.CHART_BODY_BACKGROUND_CLASS],[["width",l+""],["height",c+""]],p);const S=new Map;o.forEach(((s,i)=>{S.set(s.task.uuid,e("rect",[t.CHART_ROW_BACKGROUND_CLASS],[["y",i*a+""],["width",l+""],["height",a+""]],p))}));for(let s=0;s<o.length;){const i=++s*a-r/2;e("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1","0"],["y1",i+""],["x2",l+""],["y2",i+""]],p)}h.forEach((s=>{e("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1",s+""],["y1","0"],["x2",s+""],["y2",c+""]],p)}));const E=n().startOf("day").diff(d,"day")*i,A=new Map,m=new Map;o.forEach(((s,n)=>{const r=n*a,o=e("svg",[t.CHART_ROW_WRAPPER_CLASS],[["y",r+""],["width",l+""],["height",a+""],["data-tsg-row-uuid",s.task.uuid]],p);if(o.addEventListener("click",(e=>{o.dispatchEvent(new CustomEvent(t.ROW_CLICK_EVENT,{bubbles:!0,detail:{task:s.task,event:e}}))})),o.addEventListener("contextmenu",(e=>{o.dispatchEvent(new CustomEvent(t.ROW_CONTEXT_MENU_EVENT,{bubbles:!0,detail:{task:s.task,event:e}}))})),A.set(s.task.uuid,o),e("rect",[t.CHART_ROW_CLASS],[["width",l+""],["height",a+""]],o),s.barSvg){const t=s.minDate.diff(d,"day")*i;m.set(s.task.uuid,t),s.barSvg.setAttribute("x",t+""),o.append(s.barSvg)}})),_&&e("line",[t.CHART_BODY_TODAY_LINE_CLASS],[["x1",E+""],["y1","0"],["x2",E+""],["y2",c+""]],p),this._chartRowBgs=S,this._chartRowFgs=A,this._chartOffsetsX=m,this._htmlBody=p}redraw(){const e=this._html,s=document.createElement("div");s.classList.add(t.CHART_CLASS),s.append(this._htmlHeader,this._htmlBody),e.replaceWith(s),this._html=s}}class c{constructor(t,e=null){if(this._separatorDragActive=!1,this._ignoreNextScrollEvent=!1,this._tasks=[],this._tasksByParentUuid=new Map,this._selectedTasks=[],this.onResize=t=>{const e=this._htmlWrapper.getBoundingClientRect().width,s=this._htmlTableWrapper.getBoundingClientRect().width;this._htmlChartWrapper.style.width=e-s-this._options.separatorWidthPx+"px"},this.onMouseDownOnPartsSeparator=t=>{document.addEventListener("mousemove",this.onMouseMoveWhileResizingParts),document.addEventListener("mouseup",this.onMouseUpWhileResizingParts),document.addEventListener("touchmove",this.onMouseMoveWhileResizingParts),document.addEventListener("touchend",this.onMouseUpWhileResizingParts),this._separatorDragActive=!0},this.onMouseMoveWhileResizingParts=t=>{if(!this._separatorDragActive)return!1;const e=this._htmlWrapper.getBoundingClientRect(),s=e.left,i=e.width,n=t instanceof MouseEvent?t.clientX-s:t.touches[0].clientX-s;this._htmlTableWrapper.style.width=n-this._options.separatorWidthPx+"px",this._htmlChartWrapper.style.width=i-n+"px"},this.onMouseUpWhileResizingParts=t=>{document.removeEventListener("mousemove",this.onMouseMoveWhileResizingParts),document.removeEventListener("mouseup",this.onMouseUpWhileResizingParts),document.removeEventListener("touchmove",this.onMouseMoveWhileResizingParts),document.removeEventListener("touchend",this.onMouseUpWhileResizingParts),this._separatorDragActive=!1},this.onWrapperScroll=t=>{if(this._ignoreNextScrollEvent)return void(this._ignoreNextScrollEvent=!1);this._ignoreNextScrollEvent=!0;const e=t.currentTarget,s=e.scrollTop;e===this._htmlTableWrapper?this._htmlChartWrapper.scrollTop!==s&&(this._htmlChartWrapper.scrollTop=s):e===this._htmlChartWrapper&&this._htmlTableWrapper.scrollTop!==s&&(this._htmlTableWrapper.scrollTop=s)},this.onRowClick=t=>{const e=t.detail;if(!e)return;const{task:s,event:i}=e;1===i.detail?(this.changeSelection(s,i.ctrlKey),this.onRowClickCb&&this.onRowClickCb(s.toModel(),i)):2===i.detail&&this.onRowDoubleClickCb&&this.onRowDoubleClickCb(s.toModel(),i)},this.onRowContextMenu=t=>{const e=t.detail;if(!e)return;const{task:s,event:i}=e;this.onRowContextMenuCb&&this.onRowContextMenuCb(s.toModel(),i)},this.onRowExpanderClick=t=>{this.toggleTaskExpanded(t.detail.task)},this._options=e instanceof s?e:new s(e),this.setCssVariables(this._options),this._htmlContainer=document.querySelector(t),!this._htmlContainer)throw new Error("Container is null");this.createLayout()}get tasks(){return this._tasks.map((t=>t.toModel()))}set tasks(t){this.updateTasks(t)}get selectedTasks(){return this._selectedTasks.map((t=>t.toModel()))}set selectedTasks(t){const e=t.map((t=>t.id)),s=this._tasks.filter((t=>e.includes(t.externalId)));this.selectTasks(s)}set locale(t){t!==this._options.locale&&(this._options.locale=t,this.updateLocale())}set chartScale(t){t!==this._options.chartScale&&(this._options.chartScale=t,this.updateChartScale())}set chartDisplayMode(t){t!==this._options.chartDisplayMode&&(this._options.chartDisplayMode=t,this.updateChartDisplayMode())}destroy(){this.removeWindowEventListeners(),this.removeDocumentEventListeners(),this._htmlWrapper.remove()}expandAll(t){for(const e of this._tasks)e.expanded=t,e.parentUuid&&(e.shown=t);this.update(null)}setCssVariables(e){document.documentElement.style.setProperty(t.CSS_VAR_SEPARATOR_WIDTH,e.separatorWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_HEADER_HEIGHT,e.headerHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_ROW_HEIGHT,e.rowHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_GRIDLINES_WIDTH,e.borderWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_BAR_STROKE_WIDTH,e.barStrokeWidthPx+"px")}createLayout(){const e=document.createElement("div");e.classList.add(t.WRAPPER_CLASS,t.TEXT_SELECTION_DISABLED);const s=document.createElement("div");s.classList.add(t.TABLE_WRAPPER_CLASS);const i=document.createElement("div");i.classList.add(t.CHART_WRAPPER_CLASS);const n=document.createElement("div");n.classList.add(t.SEPARATOR_CLASS),this._table=new d(this._options),this._chart=new l(this._options),e.append(s),e.append(n),e.append(i),s.append(this._table.html),i.append(this._chart.html),s.addEventListener("scroll",this.onWrapperScroll),i.addEventListener("scroll",this.onWrapperScroll),n.addEventListener("mousedown",this.onMouseDownOnPartsSeparator),n.addEventListener("touchstart",this.onMouseDownOnPartsSeparator),this._htmlContainer.append(e),this._htmlWrapper=e,this._htmlTableWrapper=s,this._htmlChartWrapper=i,window.addEventListener("resize",this.onResize),document.addEventListener(t.ROW_CLICK_EVENT,this.onRowClick),document.addEventListener(t.ROW_CONTEXT_MENU_EVENT,this.onRowContextMenu),document.addEventListener(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,this.onRowExpanderClick)}removeWindowEventListeners(){window.removeEventListener("resize",this.onResize)}removeDocumentEventListeners(){document.removeEventListener(t.ROW_CLICK_EVENT,this.onRowClick),document.removeEventListener(t.ROW_CONTEXT_MENU_EVENT,this.onRowContextMenu),document.removeEventListener(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,this.onRowExpanderClick)}updateTasks(t){const e=this._tasks,s=a.createTasksIdMap(e),i=a.convertModelsToTasks(t,s),n=a.detectTaskChanges({oldTasks:e,newTasks:i});this._tasks=n.all,this.groupAndSortTasks(),this.update(n)}update(t){const e=this.getShownUuidsRecursively();this._table.update(!1,t,e),this._chart.update(!1,t,e),this.refreshSelection()}toggleTaskExpanded(t){t.expanded=!t.expanded,this.update(null)}changeSelection(t,e){if(!t)return;const s=[],i=this._selectedTasks.includes(t);this._options.multilineSelection&&(!this._options.useCtrlKeyForMultilineSelection||this._options.useCtrlKeyForMultilineSelection&&e)?(s.push(...this._selectedTasks),i?s.splice(s.findIndex((e=>e===t)),1):s.push(t)):s.push(t),this.selectTasks(s)}refreshSelection(){const t=this._selectedTasks.filter((t=>!a.checkForCollapsedParent(this._tasks,t)));this.selectTasks(t)}selectTasks(t){const e=this._selectedTasks;if(0===e.length&&0===t.length)return;const s=e.map((t=>t.uuid)),i=t.map((t=>t.uuid));if(function(t,e){if(t.size!==e.size)return!1;const s=new Set([...t,...e]);return t.size===s.size}(new Set(s),new Set(i)))return;const n=i,a=s.filter((t=>!i.includes(t)));this._selectedTasks=t;const r={selected:n,deselected:a};this._table.applySelection(r),this._chart.applySelection(r),t&&this.scrollChartToTasks(i),this.onSelectionChangeCb&&this.onSelectionChangeCb(t.map((t=>t.toModel())))}scrollChartToTasks(t){const e=Math.min(...t.map((t=>this._chart.getBarOffsetByTaskUuid(t))));e&&(this._htmlChartWrapper.scrollLeft=e-20)}updateLocale(){const t={deleted:[],added:[],changed:this._tasks,all:this._tasks};this._table.update(!0,t),this._chart.update(!0,t)}updateChartScale(){this._chart.update(!0,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}updateChartDisplayMode(){this._chart.update(!1,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}groupAndSortTasks(){this._tasksByParentUuid.clear();for(const t of this._tasks)this._tasksByParentUuid.has(t.parentUuid)?this._tasksByParentUuid.get(t.parentUuid).push(t):this._tasksByParentUuid.set(t.parentUuid,[t]);this._tasksByParentUuid.forEach((t=>t.sort(this._options.taskComparer||a.defaultComparer)))}getShownUuidsRecursively(t=null){const e=this._tasksByParentUuid.get(t)||[],s=[];for(const t of e)s.push(t.uuid),t.expanded&&s.push(...this.getShownUuidsRecursively(t.uuid));return s}}export{c as TsGantt,s as TsGanttOptions,a as TsGanttTask};
