class t{}function e(t,e=[],n=[],s=null,a=null){const i=document.createElementNS("http://www.w3.org/2000/svg",t);for(const t of n)i.setAttribute(t[0],t[1]);return 0!==e.length&&i.classList.add(...e),a&&(i.innerHTML=a),s&&s.append(i),i}t.CSS_VAR_SEPARATOR_WIDTH="--tsg-separator-width",t.CSS_VAR_HEADER_HEIGHT="--tsg-header-height",t.CSS_VAR_ROW_HEIGHT="--tsg-row-height",t.CSS_VAR_GRIDLINES_WIDTH="--tsg-gridlines-width",t.CSS_VAR_BAR_STROKE_WIDTH="--tsg-bar-stroke-width",t.TEXT_SELECTION_DISABLED="tsg-no-text-selection",t.WRAPPER_CLASS="tsg-wrapper",t.FOOTER_CLASS="tsg-footer",t.SEPARATOR_CLASS="tsg-separator",t.ROW_SELECTED_CLASS="selected",t.ROW_OVERDUE_CLASS="overdue",t.ROW_CLICK_EVENT="tsgrowclick",t.ROW_CONTEXT_MENU_EVENT="tsgrowcontextmenu",t.TABLE_WRAPPER_CLASS="tsg-table-wrapper",t.TABLE_CLASS="tsg-table",t.TABLE_COLUMN_RESIZER_CLASS="tsg-table-col-resizer",t.TABLE_COLUMN_DATA_ORDER="tsgColOrder",t.TABLE_COLUMN_REORDER_DATA="application/tsg-col-order",t.TABLE_COLUMN_REORDER_EVENT="tsgtablecolreorder",t.TABLE_HEADER_CLASS="tsg-table-header",t.TABLE_BODY_ROW_CLASS="tsg-table-body-row",t.TABLE_BODY_CELL_CLASS="tsg-table-body-cell",t.TABLE_BODY_CELL_TEXT_WRAPPER_CLASS="tsg-table-body-cell-text-wrapper",t.TABLE_BODY_CELL_TEXT_CLASS="tsg-table-body-cell-text",t.TABLE_BODY_CELL_EXPANDER_CLASS="tsg-table-body-cell-text-expander",t.TABLE_BODY_CELL_EXPANDER_NESTING_PREFIX="nesting-",t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT="tsgexpanderclick",t.CHART_WRAPPER_CLASS="tsg-chart-wrapper",t.CHART_CLASS="tsg-chart",t.CHART_HEADER_CLASS="tsg-chart-header",t.CHART_HEADER_BACKGROUND_CLASS="tsg-chart-header-bg",t.CHART_HEADER_GRIDLINES_CLASS="tsg-chart-header-gl",t.CHART_HEADER_TEXT_CLASS="tsg-chart-header-text",t.CHART_BODY_CLASS="tsg-chart-body",t.CHART_BODY_BACKGROUND_CLASS="tsg-chart-body-bg",t.CHART_BODY_GRIDLINES_CLASS="tsg-chart-body-gl",t.CHART_BODY_TODAY_LINE_CLASS="tsg-chart-body-gl-today",t.CHART_ROW_WRAPPER_CLASS="tsg-chart-row-wrapper",t.CHART_ROW_CLASS="tsg-chart-row",t.CHART_ROW_BACKGROUND_CLASS="tsg-chart-row-bg",t.CHART_BAR_GROUP_CLASS="tsg-chart-bar-group",t.CHART_BAR_WRAPPER_CLASS="tsg-chart-bar-wrapper",t.CHART_BAR_PLANNED_CLASS="tsg-chart-bar-planned",t.CHART_BAR_PLANNED_PROGRESS_CLASS="tsg-chart-bar-planned-progress",t.CHART_BAR_ACTUAL_CLASS="tsg-chart-bar-actual",t.CHART_BAR_ACTUAL_PROGRESS_CLASS="tsg-chart-bar-actual-progress";class n{constructor(t=null){this.multilineSelection=!0,this.useCtrlKeyForMultilineSelection=!0,this.drawTodayLine=!0,this.highlightRowsDependingOnTaskState=!0,this.columnsMinWidthPx=[200,100,100,100,100,100,100,100],this.columnsContentAlign=["start","end","center","center","center","center","center","center"],this.separatorWidthPx=5,this.headerHeightPx=90,this.rowHeightPx=40,this.borderWidthPx=1,this.barStrokeWidthPx=2,this.barMarginPx=2,this.barCornerRadiusPx=6,this.rowSymbols={childless:"•",collapsed:"▾",expanded:"▴"},this.chartShowProgress=!0,this.chartDisplayMode="both",this.chartScale="month",this.chartDateOffsetDays={day:14,week:60,month:240,year:730},this.chartDateOffsetDaysMin={day:7,week:30,month:120,year:365},this.chartDayWidthPx={day:60,week:20,month:3,year:1},this.locale="en",this.localeDecimalSeparator={en:".",uk:",",ru:",",ja:"."},this.localeDateFormat={en:"MM/DD/YYYY",uk:"DD.MM.YYYY",ru:"DD.MM.YYYY",ja:"YYYY/MM/DD"},this.localeFirstWeekDay={en:0,uk:1,ru:1,ja:0},this.localeDateMonths={en:["January","February","March","April","May","June","July","August","September","October","November","December"],uk:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],ru:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],ja:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},this.localeDateDays={en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],uk:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"],ru:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],ja:["日曜日","月曜日","火曜日","水曜日","木曜日","金曜日","土曜日"]},this.localeDateDaysShort={en:["Su","Mo","Tu","We","Th","Fr","Sa"],uk:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],ru:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],ja:["日","月","火","水","木","金","土"]},this.localeDateScale={en:["Weeks","Months","Years"],uk:["Тижні","Місяці","Роки"],ru:["Недели","Месяцы","Годы"],ja:["週間","月間","年間"]},this.localeFooters={en:["Total tasks","Completed"],uk:["Всього задач","Завершено"],ru:["Всего задач","Завершено"],ja:["総タスク","完了"]},this.localeHeaders={en:["Name","Progress","Start date planned","End date planned","Start date actual","End date actual","Duration planned","Duration actual"],uk:["Ім'я","Прогрес","Дата початку планована","Дата завершення планована","Дата початку фактична","Дата завершення фактична","Тривалість планована","Тривалість фактична"],ru:["Имя","Прогресс","Дата начала планируемая","Дата окончания планируемая","Дата начала фактическая","Дата окончания фактическая","Длительность планируемая","Длительность фактическая"],ja:["タイトル","進捗","予定開始日","予定終了日","実績開始日","実績終了日","予定日数","実績日数"]},this.localeDurationFormatters={en:t=>1===t?"1 day":t+" days",uk:t=>{let e=t%100;return e>10&&e<20?t+" днів":(e%=10,1===e?t+" день":e<5&&e>0?t+" дні":t+" днів")},ru:t=>{let e=t%100;return e>10&&e<20?t+" дней":(e%=10,1===e?t+" день":e<5&&e>0?t+" дня":t+" дней")},ja:t=>1===t?"1 日":t+" 日間"},this.columnValueGetters=[t=>t.localizedNames&&t.localizedNames[this.locale]||t.name,t=>(+t.progress.toFixed(2)).toLocaleString("en-US").replace(".",this.localeDecimalSeparator[this.locale]||".")+" %",t=>t.datePlannedStart?t.datePlannedStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.datePlannedEnd?t.datePlannedEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualStart?t.dateActualStart.format(this.localeDateFormat[this.locale]||"L"):"",t=>t.dateActualEnd?t.dateActualEnd.format(this.localeDateFormat[this.locale]||"L"):"",t=>{if(!t.datePlannedEnd||!t.datePlannedStart)return"";const e=t.datePlannedEnd,n=t.datePlannedStart,s=e.diff(n,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](s):s.toString()},t=>{if(!t.dateActualEnd||!t.dateActualStart)return"";const e=t.dateActualEnd,n=t.dateActualStart,s=e.diff(n,"day")+1;return this.localeDurationFormatters[this.locale]?this.localeDurationFormatters[this.locale](s):s.toString()}],null!=t&&Object.assign(this,t)}}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var s={exports:{}},a=s.exports=function(){var t=1e3,e=6e4,n=36e5,s="millisecond",a="second",i="minute",r="hour",o="day",l="week",d="month",h="quarter",c="year",u="date",g="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},m=function(t,e,n){var s=String(t);return!s||s.length>=e?t:""+Array(e+1-s.length).join(n)+t},E={s:m,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),s=Math.floor(n/60),a=n%60;return(e<=0?"+":"-")+m(s,2,"0")+":"+m(a,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var s=12*(n.year()-e.year())+(n.month()-e.month()),a=e.clone().add(s,d),i=n-a<0,r=e.clone().add(s+(i?-1:1),d);return+(-(s+(n-a)/(i?a-r:r-a))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:d,y:c,w:l,d:o,D:u,h:r,m:i,s:a,ms:s,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},v="en",S={};S[v]=f;var A=function(t){return t instanceof y},C=function t(e,n,s){var a;if(!e)return v;if("string"==typeof e){var i=e.toLowerCase();S[i]&&(a=i),n&&(S[i]=n,a=i);var r=e.split("-");if(!a&&r.length>1)return t(r[0])}else{var o=e.name;S[o]=e,a=o}return!s&&a&&(v=a),a||!s&&v},R=function(t,e){if(A(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new y(n)},L=E;L.l=C,L.i=A,L.w=function(t,e){return R(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var y=function(){function f(t){this.$L=C(t.locale,null,!0),this.parse(t)}var m=f.prototype;return m.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(L.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var s=e.match(p);if(s){var a=s[2]-1||0,i=(s[7]||"0").substring(0,3);return n?new Date(Date.UTC(s[1],a,s[3]||1,s[4]||0,s[5]||0,s[6]||0,i)):new Date(s[1],a,s[3]||1,s[4]||0,s[5]||0,s[6]||0,i)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},m.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},m.$utils=function(){return L},m.isValid=function(){return!(this.$d.toString()===g)},m.isSame=function(t,e){var n=R(t);return this.startOf(e)<=n&&n<=this.endOf(e)},m.isAfter=function(t,e){return R(t)<this.startOf(e)},m.isBefore=function(t,e){return this.endOf(e)<R(t)},m.$g=function(t,e,n){return L.u(t)?this[e]:this.set(n,t)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(t,e){var n=this,s=!!L.u(e)||e,h=L.p(t),g=function(t,e){var a=L.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return s?a:a.endOf(o)},p=function(t,e){return L.w(n.toDate()[t].apply(n.toDate("s"),(s?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},_=this.$W,f=this.$M,m=this.$D,E="set"+(this.$u?"UTC":"");switch(h){case c:return s?g(1,0):g(31,11);case d:return s?g(1,f):g(0,f+1);case l:var v=this.$locale().weekStart||0,S=(_<v?_+7:_)-v;return g(s?m-S:m+(6-S),f);case o:case u:return p(E+"Hours",0);case r:return p(E+"Minutes",1);case i:return p(E+"Seconds",2);case a:return p(E+"Milliseconds",3);default:return this.clone()}},m.endOf=function(t){return this.startOf(t,!1)},m.$set=function(t,e){var n,l=L.p(t),h="set"+(this.$u?"UTC":""),g=(n={},n[o]=h+"Date",n[u]=h+"Date",n[d]=h+"Month",n[c]=h+"FullYear",n[r]=h+"Hours",n[i]=h+"Minutes",n[a]=h+"Seconds",n[s]=h+"Milliseconds",n)[l],p=l===o?this.$D+(e-this.$W):e;if(l===d||l===c){var _=this.clone().set(u,1);_.$d[g](p),_.init(),this.$d=_.set(u,Math.min(this.$D,_.daysInMonth())).$d}else g&&this.$d[g](p);return this.init(),this},m.set=function(t,e){return this.clone().$set(t,e)},m.get=function(t){return this[L.p(t)]()},m.add=function(s,h){var u,g=this;s=Number(s);var p=L.p(h),_=function(t){var e=R(g);return L.w(e.date(e.date()+Math.round(t*s)),g)};if(p===d)return this.set(d,this.$M+s);if(p===c)return this.set(c,this.$y+s);if(p===o)return _(1);if(p===l)return _(7);var f=(u={},u[i]=e,u[r]=n,u[a]=t,u)[p]||1,m=this.$d.getTime()+s*f;return L.w(m,this)},m.subtract=function(t,e){return this.add(-1*t,e)},m.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||g;var s=t||"YYYY-MM-DDTHH:mm:ssZ",a=L.z(this),i=this.$H,r=this.$m,o=this.$M,l=n.weekdays,d=n.months,h=function(t,n,a,i){return t&&(t[n]||t(e,s))||a[n].slice(0,i)},c=function(t){return L.s(i%12||12,t,"0")},u=n.meridiem||function(t,e,n){var s=t<12?"AM":"PM";return n?s.toLowerCase():s},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:L.s(o+1,2,"0"),MMM:h(n.monthsShort,o,d,3),MMMM:h(d,o),D:this.$D,DD:L.s(this.$D,2,"0"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,l,2),ddd:h(n.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(i),HH:L.s(i,2,"0"),h:c(1),hh:c(2),a:u(i,r,!0),A:u(i,r,!1),m:String(r),mm:L.s(r,2,"0"),s:String(this.$s),ss:L.s(this.$s,2,"0"),SSS:L.s(this.$ms,3,"0"),Z:a};return s.replace(_,(function(t,e){return e||p[t]||a.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(s,u,g){var p,_=L.p(u),f=R(s),m=(f.utcOffset()-this.utcOffset())*e,E=this-f,v=L.m(this,f);return v=(p={},p[c]=v/12,p[d]=v,p[h]=v/3,p[l]=(E-m)/6048e5,p[o]=(E-m)/864e5,p[r]=E/n,p[i]=E/e,p[a]=E/t,p)[_]||E,g?v:L.a(v)},m.daysInMonth=function(){return this.endOf(d).$D},m.$locale=function(){return S[this.$L]},m.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),s=C(t,e,!0);return s&&(n.$L=s),n},m.clone=function(){return L.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},f}(),w=y.prototype;return R.prototype=w,[["$ms",s],["$s",a],["$m",i],["$H",r],["$W",o],["$M",d],["$y",c],["$D",u]].forEach((function(t){w[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),R.extend=function(t,e){return t.$i||(t(e,y,R),t.$i=!0),R},R.locale=C,R.isDayjs=A,R.unix=function(t){return R(1e3*t)},R.en=S[v],R.Ls=S,R.p={},R}();class i{constructor(t,e,n,s,i,r,o=null,l=null,d=null,h=null,c=0,u=!1,g=null,p=null){Object.assign(this,t),this.externalId=e,this.parentExternalId=n,this.name=s,this.localizedNames=i,this.progress=r<0?0:r>100?100:r,this.datePlannedStart=o?a(o):null,this.datePlannedEnd=l?a(l):null,this.dateActualStart=d?a(d):null,this.dateActualEnd=h?a(h):null,this.nestingLvl=c,this.hasChildren=u,this.parentUuid=g,this.uuid=p||crypto.getRandomValues(new Uint32Array(4)).join("-"),this.expanded=!1}static convertModelsToTasks(t,e=new Map){const n=t.slice(),s=new Set(n.map((t=>t.parentId))),a=[];let r=[];for(let t=n.length-1;t>=0;t--){const o=n[t];if(!o.parentId){const l=new i(o,o.id,o.parentId,o.name,o.localizedNames,o.progress,o.datePlannedStart,o.datePlannedEnd,o.dateActualStart,o.dateActualEnd,0,s.has(o.id),null,e.get(o.id));a.push(l),r.push(l),n.splice(t,1)}}let o=1;for(;0!==r.length;){const t=[];r.filter((t=>t.hasChildren)).forEach((r=>{for(let l=n.length-1;l>=0;l--){const d=n[l];if(d.parentId===r.externalId){const h=new i(d,d.id,d.parentId,d.name,d.localizedNames,d.progress,d.datePlannedStart,d.datePlannedEnd,d.dateActualStart,d.dateActualEnd,o,s.has(d.id),r.uuid,e.get(d.id));a.push(h),t.push(h),n.splice(l,1)}}})),r=t,o++}return a}static detectTaskChanges(t){const{oldTasks:e,newTasks:n}=t,s=new Map;e.forEach((t=>{s.set(t.uuid,t)}));const a=new Set;n.forEach((t=>{a.add(t.uuid)}));const i=e.filter((t=>!a.has(t.uuid))),r=[],o=[],l=[];for(const t of n){if(!s.has(t.uuid)){r.push(t),l.push(t);continue}const e=s.get(t.uuid);t.equals(e)?l.push(e):(o.push(t),l.push(t))}return{deleted:i,added:r,changed:o,all:l}}static createTasksIdMap(t){const e=new Map;for(const n of t)e.has(n.externalId)||e.set(n.externalId,n.uuid);return e}static checkPaternity(t,e,n){var s;let a=n.parentUuid;for(;a;){if(a===e.uuid)return!0;a=null===(s=t.find((t=>t.uuid===a)))||void 0===s?void 0:s.parentUuid}return!1}static checkForCollapsedParent(t,e){for(;e.parentUuid;)if(!(e=t.find((t=>t.uuid===e.parentUuid))).expanded)return!0;return!1}static sortTasksRecursively(t,e){const n=t.filter((t=>t.parentUuid===e)).sort(i.defaultComparer),s=[];for(const e of n)s.push(e),s.push(...this.sortTasksRecursively(t,e.uuid));return s}equals(t){var e,n,s,a,i,r,o,l;return this.externalId===t.externalId&&this.parentExternalId===t.parentExternalId&&this.nestingLvl===t.nestingLvl&&this.hasChildren===t.hasChildren&&this.name===t.name&&this.progress===t.progress&&(null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())===(null===(n=t.datePlannedStart)||void 0===n?void 0:n.unix())&&(null===(s=this.datePlannedEnd)||void 0===s?void 0:s.unix())===(null===(a=t.datePlannedEnd)||void 0===a?void 0:a.unix())&&(null===(i=this.dateActualStart)||void 0===i?void 0:i.unix())===(null===(r=t.dateActualStart)||void 0===r?void 0:r.unix())&&(null===(o=this.dateActualEnd)||void 0===o?void 0:o.unix())===(null===(l=t.dateActualEnd)||void 0===l?void 0:l.unix())}compareTo(t){var e,n,s,a,i,r,o,l,d,h,c,u,g,p,_,f;return this.nestingLvl>t.nestingLvl?1:this.nestingLvl<t.nestingLvl?-1:((null===(e=this.datePlannedStart)||void 0===e?void 0:e.unix())||0)>((null===(n=t.datePlannedStart)||void 0===n?void 0:n.unix())||0)?1:((null===(s=this.datePlannedStart)||void 0===s?void 0:s.unix())||0)<(null===(a=t.datePlannedStart)||void 0===a?void 0:a.unix())?-1:((null===(i=this.datePlannedEnd)||void 0===i?void 0:i.unix())||0)>((null===(r=t.datePlannedEnd)||void 0===r?void 0:r.unix())||0)?1:((null===(o=this.datePlannedEnd)||void 0===o?void 0:o.unix())||0)<((null===(l=t.datePlannedEnd)||void 0===l?void 0:l.unix())||0)?-1:((null===(d=this.dateActualStart)||void 0===d?void 0:d.unix())||0)>((null===(h=t.dateActualStart)||void 0===h?void 0:h.unix())||0)?1:((null===(c=this.dateActualStart)||void 0===c?void 0:c.unix())||0)<((null===(u=t.dateActualStart)||void 0===u?void 0:u.unix())||0)?-1:((null===(g=this.dateActualEnd)||void 0===g?void 0:g.unix())||0)>((null===(p=t.dateActualEnd)||void 0===p?void 0:p.unix())||0)?1:((null===(_=this.dateActualEnd)||void 0===_?void 0:_.unix())||0)<((null===(f=t.dateActualEnd)||void 0===f?void 0:f.unix())||0)?-1:this.name.localeCompare(t.name)}getState(){return 0===this.progress?"not-started":100===this.progress?this.datePlannedEnd&&(this.dateActualEnd&&this.dateActualEnd.isAfter(this.datePlannedEnd)||this.dateActualStart&&this.dateActualStart.isAfter(this.datePlannedEnd))?"completed-late":"completed":this.datePlannedEnd&&this.datePlannedEnd.isBefore(a().startOf("day"))?"overdue":"in-progress"}toModel(){var t,e,n,s;const a={};return Object.assign(a,this),a.id=this.externalId,a.parentId=this.parentExternalId,a.name=this.name,a.progress=this.progress,a.datePlannedStart=(null===(t=this.datePlannedStart)||void 0===t?void 0:t.toDate())||null,a.datePlannedEnd=(null===(e=this.datePlannedEnd)||void 0===e?void 0:e.toDate())||null,a.dateActualStart=(null===(n=this.dateActualStart)||void 0===n?void 0:n.toDate())||null,a.dateActualEnd=(null===(s=this.dateActualEnd)||void 0===s?void 0:s.toDate())||null,a.localizedNames=this.localizedNames,a}}i.defaultComparer=(t,e)=>t.compareTo(e);class r{constructor(t){this._columnOrder=Array.from(new Array(t).keys())}move(t,e){this._columnOrder.splice(e,0,this._columnOrder.splice(t,1)[0])}*[Symbol.iterator](){for(const t of this._columnOrder)yield t}}class o{constructor(t,e,n,s,a){this._dragActive=!1,this.onMouseDownOnResizer=t=>{document.addEventListener("mousemove",this.onMouseMoveWhileResizing),document.addEventListener("mouseup",this.onMouseUpWhileResizing),document.addEventListener("touchmove",this.onMouseMoveWhileResizing,{passive:!1}),document.addEventListener("touchend",this.onMouseUpWhileResizing),this._dragActive=!0},this.onMouseMoveWhileResizing=t=>{if(!this._dragActive)return!1;const e=this.html.getBoundingClientRect().left,n=t instanceof MouseEvent?t.clientX-e:t.touches[0].clientX-e;this.html.style.width=Math.max(this.minWidth,n)+"px",t.preventDefault()},this.onMouseUpWhileResizing=t=>{document.removeEventListener("mousemove",this.onMouseMoveWhileResizing),document.removeEventListener("mouseup",this.onMouseUpWhileResizing),document.removeEventListener("touchmove",this.onMouseMoveWhileResizing,{passive:!1}),document.removeEventListener("touchend",this.onMouseUpWhileResizing),this._dragActive=!1},this.minWidth=t,this.order=e,this.header=n,this.contentAlign=s,this.valueGetter=a,this.html=this.createHeaderCell(),this.resizer=this.createResizer(),this.resizer.addEventListener("mousedown",this.onMouseDownOnResizer),this.resizer.addEventListener("touchstart",this.onMouseDownOnResizer),this.html.append(this.resizer)}createHeaderCell(){const e=document.createElement("th");return e.classList.add(t.TABLE_HEADER_CLASS),e.dataset[t.TABLE_COLUMN_DATA_ORDER]=this.order+"",e.style.minWidth=this.minWidth+"px",e.style.width=this.minWidth+"px",e.draggable=!0,e.innerHTML=this.header,e.addEventListener("dragstart",(e=>{e.dataTransfer.setData(t.TABLE_COLUMN_REORDER_DATA,this.order+"")})),e.addEventListener("dragover",(t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"})),e.addEventListener("drop",(n=>{n.preventDefault();const s=n.dataTransfer.getData(t.TABLE_COLUMN_REORDER_DATA);(s||"0"===s)&&e.dispatchEvent(new CustomEvent(t.TABLE_COLUMN_REORDER_EVENT,{bubbles:!0,composed:!0,detail:{orderFrom:+s,orderTo:this.order,event:n}}))})),e}createResizer(){const e=document.createElement("div");return e.classList.add(t.TABLE_COLUMN_RESIZER_CLASS),e}}class l{constructor(t,e,n){this.task=t,this.expander=this.createExpander(),this.html=this.createRow(e,n)}createRow(e,n){const s=document.createElement("tr");return s.classList.add(t.TABLE_BODY_ROW_CLASS),s.addEventListener("click",(e=>{e.target.classList.contains(t.TABLE_BODY_CELL_EXPANDER_CLASS)||s.dispatchEvent(new CustomEvent(t.ROW_CLICK_EVENT,{bubbles:!0,composed:!0,detail:{task:this.task,event:e}}))})),s.addEventListener("contextmenu",(e=>{e.target.classList.contains(t.TABLE_BODY_CELL_EXPANDER_CLASS)||s.dispatchEvent(new CustomEvent(t.ROW_CONTEXT_MENU_EVENT,{bubbles:!0,composed:!0,detail:{task:this.task,event:e}}))})),n&&s.classList.add(this.task.getState()),e.forEach(((e,n)=>{const a=document.createElement("td");a.classList.add(t.TABLE_BODY_CELL_CLASS);const i=document.createElement("div");i.classList.add(t.TABLE_BODY_CELL_TEXT_WRAPPER_CLASS,e.contentAlign),0===n&&i.append(this.expander);const r=document.createElement("p");r.classList.add(t.TABLE_BODY_CELL_TEXT_CLASS),r.innerHTML=e.valueGetter(this.task),i.append(r),a.append(i),s.append(a)})),s}createExpander(){const e=document.createElement("p");e.classList.add(t.TABLE_BODY_CELL_EXPANDER_CLASS);const n=this.task.nestingLvl;return n&&e.classList.add(t.TABLE_BODY_CELL_EXPANDER_NESTING_PREFIX+(n<10?n:10)),this.task.hasChildren&&e.addEventListener("click",(n=>{e.dispatchEvent(new CustomEvent(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,{bubbles:!0,composed:!0,detail:{task:this.task,event:n}}))})),e}}class d{constructor(e){this._tableRows=new Map,this._activeUuids=[],this._currentTasks=[],this.onColumnReorder=t=>{const e=t.detail;e&&this.changeColumnIndex(e.orderFrom,e.orderTo)},this._options=e,this.initBaseHtml(),this.initColumns(),document.addEventListener(t.TABLE_COLUMN_REORDER_EVENT,this.onColumnReorder)}destroy(){this._html.remove(),document.removeEventListener(t.TABLE_COLUMN_REORDER_EVENT,this.onColumnReorder)}appendTo(t){t.append(this._html)}update(t,e,n=null){t&&this.updateColumns(),e&&this.updateRows(e),n&&(this._activeUuids=n),this.redraw()}applySelection(e){const{selected:n,deselected:s}=e;for(const e of s){const n=this._tableRows.get(e);n&&n.html.classList.remove(t.ROW_SELECTED_CLASS)}for(const e of n){const n=this._tableRows.get(e);n&&n.html.classList.add(t.ROW_SELECTED_CLASS)}}initBaseHtml(){const e=document.createElement("table");e.classList.add(t.TABLE_CLASS);const n=e.createTHead(),s=e.createTBody();this._htmlHead=n,this._htmlBody=s,this._html=e}initColumns(){this._columnOrder=new r(this._options.columnsMinWidthPx.length),this.updateColumns()}updateColumns(){const t=[];let e=0;for(const n of this._columnOrder){const s=this._options.columnsMinWidthPx[n];s&&t.push(new o(s,e++,this._options.localeHeaders[this._options.locale][n]||"",this._options.columnsContentAlign[n],this._options.columnValueGetters[n]||(t=>"")))}this._tableColumns=t}changeColumnIndex(t,e){this._columnOrder.move(t,e),this.updateColumns(),this.updateRows({added:[],deleted:[],changed:this._currentTasks,all:this._currentTasks}),this.redraw()}updateRows(t){const e=this._tableColumns,n=this._tableRows,s=this._options.highlightRowsDependingOnTaskState;t.deleted.forEach((t=>n.delete(t.uuid))),t.changed.forEach((t=>n.set(t.uuid,new l(t,e,s)))),t.added.forEach((t=>n.set(t.uuid,new l(t,e,s)))),this._currentTasks=t.all}redraw(){const t=document.createElement("tr");this._tableColumns.forEach((e=>t.append(e.html))),this._htmlHead.innerHTML="",this._htmlHead.append(t),this._htmlBody.innerHTML="",this._htmlBody.append(...this._activeUuids.map((t=>this.getRowHtml(t))))}getRowHtml(t){const e=this._options.rowSymbols,n=this._tableRows.get(t);return n.task.hasChildren?n.task.expanded?n.expander.innerHTML=e.expanded:n.expander.innerHTML=e.collapsed:n.expander.innerHTML=e.childless,n.html}}class h{constructor(t,e){const{mode:n,showProgress:s,dayWidth:a,rowHeight:i,barMinWidth:r,barHeight:o,barBorder:l,barCornerR:d,y0:h,y1:c}=e,{datePlannedStart:u,datePlannedEnd:g,dateActualStart:p,dateActualEnd:_}=t,f=u&&g,m=p&&_;let E,v,S;"both"===n?(m||f)&&(m&&f?(E=u.isBefore(p)?u:p,v=g.isAfter(_)?g:_):f?(E=u,v=g):(E=p,v=_),S=this.createSvg(E,v,a,r,i),f&&this.createBar(S,E,u,g,a,r,o,h,l,d,"planned",t.progress,s),m&&this.createBar(S,E,p,_,a,r,o,c,l,d,"actual",t.progress,s)):"planned"===n&&f?(E=u,v=g,S=this.createSvg(E,v,a,r,i),this.createBar(S,E,E,v,a,r,o,h,l,d,"planned",t.progress,s)):"actual"===n&&m&&(E=p,v=_,S=this.createSvg(E,v,a,r,i),this.createBar(S,E,E,v,a,r,o,h,l,d,"actual",t.progress,s)),this.minDate=E,this.maxDate=v,this.barSvg=S,this.task=t}createSvg(n,s,a,i,r){const o=s.diff(n,"day")+1,l=Math.max(o*a+i,i);return e("svg",[t.CHART_BAR_GROUP_CLASS],[["width",l+""],["height",r+""]])}createBar(n,s,a,i,r,o,l,d,h,c,u,g,p){const _="planned"===u?[t.CHART_BAR_PLANNED_CLASS]:[t.CHART_BAR_ACTUAL_CLASS],f="planned"===u?[t.CHART_BAR_PLANNED_PROGRESS_CLASS]:[t.CHART_BAR_ACTUAL_PROGRESS_CLASS],m=a.diff(s,"day")*r,E=i.diff(a,"day")+1,v=Math.max(E*r,o),S=e("svg",[t.CHART_BAR_WRAPPER_CLASS],[["x",m+""],["y",d+""],["width",v+""],["height",l+""]],n),A=h/2,C=v-h,R=l-h;if(e("rect",_,[["x",A+""],["y",A+""],["width",C+""],["height",R+""],["rx",c+""],["ry",c+""]],S),p){const t=C*g/100;e("rect",f,[["x",A+""],["y",A+""],["width",(t<o-h?0:t)+""],["height",R+""],["rx",c+""],["ry",c+""]],S)}}}class c{constructor(t){this._chartBarGroups=new Map,this._activeUuids=[],this._options=t,this._html=this.createChartDiv()}destroy(){this._html.remove()}appendTo(t){t.append(this._html)}update(t,e,n=null){(!e||this.checkDates(e.all))&&!t||this.refreshHeader(),e&&this.refreshBarGroups(e),n&&(this._activeUuids=n),this.refreshBody(),this.redraw()}applySelection(e){const{selected:n,deselected:s}=e;for(const e of s){const n=this._chartRowBgs.get(e);n&&n.classList.remove(t.ROW_SELECTED_CLASS);const s=this._chartRowFgs.get(e);s&&s.classList.remove(t.ROW_SELECTED_CLASS)}for(const e of n){const n=this._chartRowBgs.get(e);n&&n.classList.add(t.ROW_SELECTED_CLASS);const s=this._chartRowFgs.get(e);s&&s.classList.add(t.ROW_SELECTED_CLASS)}}getBarOffsetByTaskUuid(t){return this._chartOffsetsX.get(t)}createChartDiv(){const e=document.createElement("div");return e.classList.add(t.CHART_CLASS),e}checkDates(t){const e=this._dateMinOffset,n=this._dateMaxOffset,s=this._options.chartScale,i=this._options.chartDateOffsetDaysMin[s],r=this._options.chartDateOffsetDays[s];let o=a(),l=a();for(const e of t){const t=a(e.datePlannedStart),n=a(e.datePlannedEnd),s=e.dateActualStart?a(e.dateActualStart):null,i=e.dateActualEnd?a(e.dateActualEnd):null;t.isBefore(o)&&(o=t),n.isAfter(l)&&(l=n),s&&s.isBefore(o)&&(o=s),i&&i.isAfter(l)&&(l=i)}return(!e||e.isAfter(o)||o.diff(e,"day")<i)&&(this._dateMinOffset=o.subtract(r,"day")),(!n||n.isBefore(l)||n.diff(l,"day")<i)&&(this._dateMaxOffset=l.add(r,"day")),this._dateMinOffset===e&&this._dateMaxOffset===n}getBarGroupOptions(){const t=this._options.chartDisplayMode,e=this._options.chartShowProgress,n=this._options.chartDayWidthPx[this._options.chartScale],s=this._options.rowHeightPx,a=this._options.borderWidthPx,i=this._options.barMarginPx,r=this._options.barStrokeWidthPx,o=this._options.barCornerRadiusPx,l=r+2*o,d=i-a/2;let h,c;switch(t){case"both":h=(s-3*i)/2,c=h+2*i-a/2;break;case"planned":case"actual":h=s-2*i}return{mode:t,showProgress:e,dayWidth:n,rowHeight:s,barMinWidth:l,barHeight:h,barBorder:r,barCornerR:o,y0:d,y1:c}}refreshBarGroups(t){const e=this.getBarGroupOptions();t.deleted.forEach((t=>this._chartBarGroups.delete(t.uuid))),t.changed.forEach((t=>this._chartBarGroups.set(t.uuid,new h(t,e)))),t.added.forEach((t=>this._chartBarGroups.set(t.uuid,new h(t,e))))}refreshHeader(){const n=this._options.chartScale,s=this._options.chartDayWidthPx[n],a=this._options.headerHeightPx;this._dateMinOffset;const i=this._dateMaxOffset,r=function(t,e){const n=t.startOf("day"),s=e.startOf("day");if(!n||!s||s.diff(n)<0)return[];if(0===s.diff(n))return[n];const a=[];let i=n;for(;i.isBefore(s)||i.isSame(s);)a.push(i),i=i.add(1,"day");return a}(this._dateMinOffset,this._dateMaxOffset),o=r.length*s,l=this._options.locale,d=this._options.localeDateMonths[l],h=this._options.localeDateDaysShort[l];this._options.localeDateDays[l];const c=e("svg",[t.CHART_HEADER_CLASS],[["width",o+""],["height",a+""]]);e("rect",[t.CHART_HEADER_BACKGROUND_CLASS],[["width",o+""],["height",a+""]],c);let u=0,g=0,p=0;const _=[];if("year"===n)for(const n of r){const r=u+s;if(n.isSame(n.endOf("year").startOf("day"))||n.isSame(i)){const s=r-p,i=e("svg",[],[["x",p+""],["y","0"],["width",s+""],["height",a+""]],c);s>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,n.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1","0"],["x2",r+""],["y2",a+""]],c),_.push(r),p=r}u=r}else if("month"===n){const n=a/2,l=0,h=n;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",h+""],["x2",o+""],["y2",h+""]],c);for(const o of r){const r=u+s;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(i)){const s=r-p,a=e("svg",[],[["x",p+""],["y",l+""],["width",s+""],["height",n+""]],c);s>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,o.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",l+""],["x2",r+""],["y2",h+""]],c),p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(i)){const s=r-g,i=e("svg",[],[["x",g+""],["y",h+""],["width",s+""],["height",n+""]],c);if(s>=60){const n=d[o.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],i,n)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",h+""],["x2",r+""],["y2",a+""]],c),_.push(r),g=r}u=r}}else if("week"===n||"day"===n){const n=a/3,l=0,f=n,m=2*n;e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",f+""],["x2",o+""],["y2",f+""]],c),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1","0"],["y1",m+""],["x2",o+""],["y2",m+""]],c);for(const o of r){const r=u+s;if(o.isSame(o.endOf("year").startOf("day"))||o.isSame(i)){const s=r-p,a=e("svg",[],[["x",p+""],["y",l+""],["width",s+""],["height",n+""]],c);s>=60&&e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,o.year()+""),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",l+""],["x2",r+""],["y2",f+""]],c),p=r}if(o.isSame(o.endOf("month").startOf("day"))||o.isSame(i)){const s=r-g,a=e("svg",[],[["x",g+""],["y",f+""],["width",s+""],["height",n+""]],c);if(s>=60){const n=d[o.month()];e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],a,n)}e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",f+""],["x2",r+""],["y2",m+""]],c),g=r}const E=e("svg",[],[["x",u+""],["y",m+""],["width",s+""],["height",n+""]],c),v=s<30?o.date()+"":h[o.day()]+" "+o.date();e("text",[t.CHART_HEADER_TEXT_CLASS],[["x","50%"],["y","50%"],["dominant-baseline","middle"],["text-anchor","middle"]],E,v),e("line",[t.CHART_HEADER_GRIDLINES_CLASS],[["x1",r+""],["y1",m+""],["x2",r+""],["y2",a+""]],c),_.push(r),u=r}}this._width=o,this._headerHeight=a,this._verticalLinesXCoords=_,this._htmlHeader=c}refreshBody(){const n=this._options.chartScale,s=this._options.chartDayWidthPx[n],i=this._options.rowHeightPx,r=this._options.borderWidthPx,o=this._activeUuids.map((t=>this._chartBarGroups.get(t))),l=this._dateMinOffset,d=this._verticalLinesXCoords,h=this._width,c=i*o.length,u=this._headerHeight,g=this._options.drawTodayLine,p=e("svg",[t.CHART_BODY_CLASS],[["y",u+""],["width",h+""],["height",c+""]]);e("rect",[t.CHART_BODY_BACKGROUND_CLASS],[["width",h+""],["height",c+""]],p);const _=new Map;o.forEach(((n,s)=>{_.set(n.task.uuid,e("rect",[t.CHART_ROW_BACKGROUND_CLASS],[["y",s*i+""],["width",h+""],["height",i+""]],p))}));for(let n=0;n<o.length;){const s=++n*i-r/2;e("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1","0"],["y1",s+""],["x2",h+""],["y2",s+""]],p)}d.forEach((n=>{e("line",[t.CHART_BODY_GRIDLINES_CLASS],[["x1",n+""],["y1","0"],["x2",n+""],["y2",c+""]],p)}));const f=a().startOf("day").diff(l,"day")*s,m=new Map,E=new Map;o.forEach(((n,a)=>{const r=a*i,o=e("svg",[t.CHART_ROW_WRAPPER_CLASS],[["y",r+""],["width",h+""],["height",i+""],["data-tsg-row-uuid",n.task.uuid]],p);if(o.addEventListener("click",(e=>{o.dispatchEvent(new CustomEvent(t.ROW_CLICK_EVENT,{bubbles:!0,composed:!0,detail:{task:n.task,event:e}}))})),o.addEventListener("contextmenu",(e=>{o.dispatchEvent(new CustomEvent(t.ROW_CONTEXT_MENU_EVENT,{bubbles:!0,composed:!0,detail:{task:n.task,event:e}}))})),m.set(n.task.uuid,o),e("rect",[t.CHART_ROW_CLASS],[["width",h+""],["height",i+""]],o),n.barSvg){const t=n.minDate.diff(l,"day")*s;E.set(n.task.uuid,t),n.barSvg.setAttribute("x",t+""),o.append(n.barSvg)}})),g&&e("line",[t.CHART_BODY_TODAY_LINE_CLASS],[["x1",f+""],["y1","0"],["x2",f+""],["y2",c+""]],p),this._chartRowBgs=_,this._chartRowFgs=m,this._chartOffsetsX=E,this._htmlBody=p}redraw(){const e=this._html,n=document.createElement("div");n.classList.add(t.CHART_CLASS),n.append(this._htmlHeader,this._htmlBody),e.replaceWith(n),this._html=n}}class u{constructor(t,e=null){if(this._separatorDragActive=!1,this._ignoreNextScrollEvent=!1,this._baseComponents=[],this._tasks=[],this._tasksByParentUuid=new Map,this._selectedTasks=[],this.onResize=t=>{const e=this._htmlWrapper.getBoundingClientRect().width,n=this._htmlTableWrapper.getBoundingClientRect().width;this._htmlChartWrapper.style.width=e-n-this._options.separatorWidthPx+"px"},this.onMouseDownOnPartsSeparator=t=>{document.addEventListener("mousemove",this.onMouseMoveWhileResizingParts),document.addEventListener("mouseup",this.onMouseUpWhileResizingParts),document.addEventListener("touchmove",this.onMouseMoveWhileResizingParts),document.addEventListener("touchend",this.onMouseUpWhileResizingParts),this._separatorDragActive=!0},this.onMouseMoveWhileResizingParts=t=>{if(!this._separatorDragActive)return!1;const e=this._htmlWrapper.getBoundingClientRect(),n=e.left,s=e.width,a=t instanceof MouseEvent?t.clientX-n:t.touches[0].clientX-n;this._htmlTableWrapper.style.width=a-this._options.separatorWidthPx+"px",this._htmlChartWrapper.style.width=s-a+"px"},this.onMouseUpWhileResizingParts=t=>{document.removeEventListener("mousemove",this.onMouseMoveWhileResizingParts),document.removeEventListener("mouseup",this.onMouseUpWhileResizingParts),document.removeEventListener("touchmove",this.onMouseMoveWhileResizingParts),document.removeEventListener("touchend",this.onMouseUpWhileResizingParts),this._separatorDragActive=!1},this.onWrapperScroll=t=>{if(this._ignoreNextScrollEvent)return void(this._ignoreNextScrollEvent=!1);this._ignoreNextScrollEvent=!0;const e=t.currentTarget,n=e.scrollTop;e===this._htmlTableWrapper?this._htmlChartWrapper.scrollTop!==n&&(this._htmlChartWrapper.scrollTop=n):e===this._htmlChartWrapper&&this._htmlTableWrapper.scrollTop!==n&&(this._htmlTableWrapper.scrollTop=n)},this.onRowClick=t=>{const e=t.detail;if(!e)return;const{task:n,event:s}=e;1===s.detail?(this.changeSelection(n,s.ctrlKey),this.onRowClickCb&&this.onRowClickCb(n.toModel(),s)):2===s.detail&&this.onRowDoubleClickCb&&this.onRowDoubleClickCb(n.toModel(),s)},this.onRowContextMenu=t=>{const e=t.detail;if(!e)return;const{task:n,event:s}=e;this.onRowContextMenuCb&&this.onRowContextMenuCb(n.toModel(),s)},this.onRowExpanderClick=t=>{this.toggleTaskExpanded(t.detail.task)},this._options=e instanceof n?e:new n(e),this.setCssVariables(this._options),this._htmlContainer=document.querySelector(t),!this._htmlContainer)throw new Error("Container is null");this.createLayout()}get tasks(){return this._tasks.map((t=>t.toModel()))}set tasks(t){this.updateTasks(t)}get selectedTasks(){return this._selectedTasks.map((t=>t.toModel()))}set selectedTasks(t){const e=t.map((t=>t.id)),n=this._tasks.filter((t=>e.includes(t.externalId)));this.selectTasks(n)}set locale(t){t!==this._options.locale&&(this._options.locale=t,this.updateLocale())}set chartScale(t){t!==this._options.chartScale&&(this._options.chartScale=t,this.updateChartScale())}set chartDisplayMode(t){t!==this._options.chartDisplayMode&&(this._options.chartDisplayMode=t,this.updateChartDisplayMode())}destroy(){this.removeWindowEventListeners(),this.removeDocumentEventListeners(),this._baseComponents.forEach((t=>t.destroy())),this._htmlWrapper.remove()}expandAll(t){for(const e of this._tasks)e.expanded=t,e.parentUuid&&(e.shown=t);this.update(null)}setCssVariables(e){document.documentElement.style.setProperty(t.CSS_VAR_SEPARATOR_WIDTH,e.separatorWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_HEADER_HEIGHT,e.headerHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_ROW_HEIGHT,e.rowHeightPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_GRIDLINES_WIDTH,e.borderWidthPx+"px"),document.documentElement.style.setProperty(t.CSS_VAR_BAR_STROKE_WIDTH,e.barStrokeWidthPx+"px")}createLayout(){const e=document.createElement("div");e.classList.add(t.WRAPPER_CLASS,t.TEXT_SELECTION_DISABLED);const n=document.createElement("div");n.classList.add(t.TABLE_WRAPPER_CLASS);const s=document.createElement("div");s.classList.add(t.CHART_WRAPPER_CLASS);const a=document.createElement("div");a.classList.add(t.SEPARATOR_CLASS),this._table=new d(this._options),this._chart=new c(this._options),this._baseComponents.push(this._table,this._chart),e.append(n),e.append(a),e.append(s),this._table.appendTo(n),this._chart.appendTo(s),n.addEventListener("scroll",this.onWrapperScroll),s.addEventListener("scroll",this.onWrapperScroll),a.addEventListener("mousedown",this.onMouseDownOnPartsSeparator),a.addEventListener("touchstart",this.onMouseDownOnPartsSeparator),this._options.useShadowDom?(this._shadowRoot=this._htmlContainer.attachShadow({mode:"open"}),this._shadowRoot.innerHTML="\n<style>\n  :host {\n    --tsg-table-min-width-final: var(--tsg-table-min-width, 100px);\n    --tsg-chart-min-width-final: var(--tsg-chart-min-width, 100px);\n    --tsg-nesting-indent-final: var(--tsg-nesting-indent, 20px);\n\n    --tsg-background-color-final: var(--tsg-background-color, white);\n    --tsg-foreground-color-final: var(--tsg-foreground-color, black);\n    --tsg-separator-color-final: var(--tsg-separator-color, dimgray);\n    --tsg-header-color-final: var(--tsg-header-color, ghostwhite);\n    --tsg-border-color-final: var(--tsg-border-color, lightgray);\n    --tsg-symbol-color-final: var(--tsg-symbol-color, dimgray);\n    --tsg-selection-color-final: var(--tsg-selection-color, ghostwhite);\n\n    --tsg-not-started-fg-color-final: var(--tsg-not-started-fg-color, dimgray);\n    --tsg-in-progress-fg-color-final: var(--tsg-in-progress-fg-color, black);\n    --tsg-overdue-fg-color-final: var(--tsg-overdue-fg-color, darkred);\n    --tsg-completed-fg-color-final: var(--tsg-completed-fg-color, darkgreen);\n    --tsg-completed-late-fg-color-final: var(--tsg-completed-late-fg-color, sienna);\n\n    --tsg-today-line-color-final: var(--tsg-today-line-color, orangered);\n    --tsg-chart-bar-color-1-final: var(--tsg-chart-bar-color-1, skyblue);\n    --tsg-chart-bar-color-2-final: var(--tsg-chart-bar-color-2, lightcoral);\n    --tsg-chart-bar-accent-1-final: var(--tsg-chart-bar-accent-1, darkcyan);\n    --tsg-chart-bar-accent-2-final: var(--tsg-chart-bar-accent-2, darkred);\n\n    --tsg-font-family-final: var(--tsg-font-family, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif);\n    --tsg-font-size-final: var(--tsg-font-size, 14px);\n    --tsg-line-height-final: var(--tsg-line-height, 16px);\n    --tsg-max-cell-text-lines-final: var(--tsg-max-cell-text-lines, 2);\n  }\n\n  .tsg-no-text-selection {  \n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n  }\n\n  .tsg-wrapper {  \n    position: relative;\n    box-sizing: border-box;\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-start;\n    align-items: flex-start;\n    width: 100%;\n    height: 100%;\n    overflow-y: auto;\n    overflow-x: hidden;\n    background-color: var(--tsg-background-color-final);\n  }\n\n  .tsg-wrapper * {\n    box-sizing: border-box;\n  }\n\n  .tsg-separator {\n    display: flex;\n    flex: 0 0 auto;\n    width: var(--tsg-separator-width);\n    height: 100%;\n    padding: 0;\n    cursor: ew-resize;\n    background-color: var(--tsg-separator-color-final);\n  }\n\n  .tsg-table-wrapper {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    width: calc(50% - 5px);\n    height: 100%;\n    min-width: var(--tsg-table-min-width-final);\n    overflow-y: auto;\n    overflow-x: scroll;\n  }\n\n  .tsg-table {\n    width: 100%;\n    border-spacing: 0;\n    font-family: var(--tsg-font-family-final);\n    color: var(--tsg-foreground-color-final);\n    table-layout: fixed;\n  }\n\n  .tsg-table-header {\n    position: sticky;\n    top: 0;\n    padding: 5px;\n    height: var(--tsg-header-height) !important;\n    font-size: var(--tsg-font-size-final);\n    border-width: var(--tsg-gridlines-width) var(--tsg-gridlines-width) var(--tsg-gridlines-width) 0;\n    border-color: var(--tsg-border-color-final);\n    border-style: solid;\n    background-color: var(--tsg-header-color-final);\n    z-index: 5;\n  }\n  .tsg-table-col-resizer {\n    position: absolute;\n    top: 0;\n    right: 0;\n    width: 10px;\n    height: 100%;\n    cursor: col-resize;\n  }\n\n  .tsg-table-body-row {\n    height: var(--tsg-row-height) !important;\n  }\n  .tsg-table-body-row.selected {\n    background-color: var(--tsg-selection-color-final);\n  }\n  .selected .tsg-table-body-cell {\n    font-weight: bold;\n  }\n  .not-started .tsg-table-body-cell {\n    color: var(--tsg-not-started-fg-color-final);\n  }\n  .in-progress .tsg-table-body-cell {\n    color: var(--tsg-in-progress-fg-color-final);\n  }\n  .overdue .tsg-table-body-cell {\n    color: var(--tsg-overdue-fg-color-final);\n  }\n  .completed .tsg-table-body-cell {\n    color: var(--tsg-completed-fg-color-final);\n  }\n  .completed-late .tsg-table-body-cell {\n    color: var(--tsg-completed-late-fg-color-final);\n  }\n\n  .tsg-table-body-cell {\n    padding: 0;\n    cursor: default;\n    border-width: 0 var(--tsg-gridlines-width) var(--tsg-gridlines-width) 0;\n    border-color: var(--tsg-border-color-final);\n    border-style: solid;\n  }\n\n  .tsg-table-body-cell-text-wrapper {\n    display: flex;\n    align-items: center;\n    height: calc(var(--tsg-row-height) - 2px);\n    padding: 2px;\n  }\n  .tsg-table-body-cell-text-wrapper.start {\n    justify-content: flex-start;\n  }\n  .tsg-table-body-cell-text-wrapper.center {\n    justify-content: center;\n  }\n  .tsg-table-body-cell-text-wrapper.end {\n    justify-content: flex-end;\n  }\n\n  .tsg-table-body-cell-text-expander {\n    width: var(--tsg-nesting-indent-final) !important;\n    min-width: var(--tsg-nesting-indent-final) !important;\n    color: var(--tsg-symbol-color-final);\n    text-align: center;\n    cursor: pointer;\n  }\n  .tsg-table-body-cell-text-expander.nesting-1 {\n    padding-left: var(--tsg-nesting-indent-final) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 2) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 2) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-2 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 2) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 3) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 3) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-3 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 3) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 4) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 4) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-4 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 4) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 5) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 5) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-5 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 5) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 6) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 6) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-6 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 6) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 7) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 7) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-7 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 7) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 8) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 8) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-8 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 8) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 9) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 9) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-9 {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 9) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 10) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 10) !important;\n  }\n  .tsg-table-body-cell-text-expander.nesting-max {\n    padding-left: calc(var(--tsg-nesting-indent-final) * 10) !important;\n    width: calc(var(--tsg-nesting-indent-final) * 11) !important;\n    min-width: calc(var(--tsg-nesting-indent-final) * 11) !important;\n  }\n\n  .tsg-table-body-cell-text {\n    position: relative;\n    overflow: hidden;\n    max-height: calc(var(--tsg-max-cell-text-lines-final) * var(--tsg-line-height-final));\n    font-size: var(--tsg-font-size-final);\n    line-height: var(--tsg-line-height-final);\n    display: -webkit-box;\n    -webkit-line-clamp: var(--tsg-max-cell-text-lines-final);\n    -webkit-box-orient: vertical;\n  }\n\n  .tsg-chart-wrapper {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    width: 50%;\n    height: 100%;\n    min-width: var(--tsg-chart-min-width-final);\n    overflow-y: auto;\n    overflow-x: scroll;\n  }\n\n  .tsg-chart {\n    display: flex;\n    flex-direction: column;\n    flex-shrink: 0;\n  }\n\n  .tsg-chart-header {\n    position: sticky;\n    top: 0;\n  }\n\n  .tsg-chart-header-bg {\n    fill: var(--tsg-header-color-final);\n    stroke-width: var(--tsg-gridlines-width);\n    stroke: var(--tsg-border-color-final);\n  }\n\n  .tsg-chart-header-text {\n    font-family: var(--tsg-font-family-final);\n    font-size: var(--tsg-font-size-final);\n    font-weight: bold;\n  }\n\n  .tsg-chart-header-gl,\n  .tsg-chart-body-gl {\n    stroke-width: var(--tsg-gridlines-width);\n    stroke: var(--tsg-border-color-final);\n    shape-rendering: crispEdges;\n  }\n  .tsg-chart-body-gl-today {\n    stroke-width: calc(var(--tsg-gridlines-width) + 2px);\n    stroke: var(--tsg-today-line-color-final);\n  }\n\n  .tsg-chart-body-bg {\n    fill: transparent;\n  }\n\n  .tsg-chart-row-bg {\n    fill: var(--tsg-background-color-final);\n  }\n  .tsg-chart-row-bg.selected {\n    fill: var(--tsg-selection-color-final);\n  }\n\n  .tsg-chart-row {\n    fill: transparent;\n  }\n\n  .tsg-chart-bar-planned {\n    fill: var(--tsg-chart-bar-color-1-final);\n    stroke: var(--tsg-chart-bar-color-1-final);\n    stroke-width: var(--tsg-bar-stroke-width);\n  }\n  .selected .tsg-chart-bar-planned {\n    stroke: var(--tsg-chart-bar-accent-1-final);\n  }\n  .tsg-chart-bar-planned-progress {\n    fill: var(--tsg-chart-bar-accent-1-final);\n    stroke: var(--tsg-chart-bar-accent-1-final);\n    stroke-width: var(--tsg-bar-stroke-width);\n  }\n\n  .tsg-chart-bar-actual {\n    fill: var(--tsg-chart-bar-color-2-final);\n    stroke: var(--tsg-chart-bar-color-2-final);\n    stroke-width: var(--tsg-bar-stroke-width);\n  }\n  .selected .tsg-chart-bar-actual {\n    stroke: var(--tsg-chart-bar-accent-2-final);\n  }\n  .tsg-chart-bar-actual-progress {\n    fill: var(--tsg-chart-bar-accent-2-final);\n    stroke: var(--tsg-chart-bar-accent-2-final);\n    stroke-width: var(--tsg-bar-stroke-width);\n  }\n</style>\n",this._shadowRoot.append(e)):this._htmlContainer.append(e),this._htmlWrapper=e,this._htmlTableWrapper=n,this._htmlChartWrapper=s,window.addEventListener("resize",this.onResize),document.addEventListener(t.ROW_CLICK_EVENT,this.onRowClick),document.addEventListener(t.ROW_CONTEXT_MENU_EVENT,this.onRowContextMenu),document.addEventListener(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,this.onRowExpanderClick)}removeWindowEventListeners(){window.removeEventListener("resize",this.onResize)}removeDocumentEventListeners(){document.removeEventListener(t.ROW_CLICK_EVENT,this.onRowClick),document.removeEventListener(t.ROW_CONTEXT_MENU_EVENT,this.onRowContextMenu),document.removeEventListener(t.TABLE_BODY_CELL_EXPANDER_CLICK_EVENT,this.onRowExpanderClick)}updateTasks(t){const e=this._tasks,n=i.createTasksIdMap(e),s=i.convertModelsToTasks(t,n),a=i.detectTaskChanges({oldTasks:e,newTasks:s});this._tasks=a.all,this.groupAndSortTasks(),this.update(a)}update(t){const e=this.getShownUuidsRecursively();this._table.update(!1,t,e),this._chart.update(!1,t,e),this.refreshSelection()}toggleTaskExpanded(t){t.expanded=!t.expanded,this.update(null)}changeSelection(t,e){if(!t)return;const n=[],s=this._selectedTasks.includes(t);this._options.multilineSelection&&(!this._options.useCtrlKeyForMultilineSelection||this._options.useCtrlKeyForMultilineSelection&&e)?(n.push(...this._selectedTasks),s?n.splice(n.findIndex((e=>e===t)),1):n.push(t)):n.push(t),this.selectTasks(n)}refreshSelection(){const t=this._selectedTasks.filter((t=>!i.checkForCollapsedParent(this._tasks,t)));this.selectTasks(t)}selectTasks(t){const e=this._selectedTasks;if(0===e.length&&0===t.length)return;const n=e.map((t=>t.uuid)),s=t.map((t=>t.uuid));if(function(t,e){if(t.size!==e.size)return!1;const n=new Set([...t,...e]);return t.size===n.size}(new Set(n),new Set(s)))return;const a=s,i=n.filter((t=>!s.includes(t)));this._selectedTasks=t;const r={selected:a,deselected:i};this._table.applySelection(r),this._chart.applySelection(r),t&&this.scrollChartToTasks(s),this.onSelectionChangeCb&&this.onSelectionChangeCb(t.map((t=>t.toModel())))}scrollChartToTasks(t){const e=Math.min(...t.map((t=>this._chart.getBarOffsetByTaskUuid(t))));e&&(this._htmlChartWrapper.scrollLeft=e-20)}updateLocale(){const t={deleted:[],added:[],changed:this._tasks,all:this._tasks};this._table.update(!0,t),this._chart.update(!0,t)}updateChartScale(){this._chart.update(!0,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}updateChartDisplayMode(){this._chart.update(!1,{deleted:[],added:[],changed:this._tasks,all:this._tasks}),this.refreshSelection()}groupAndSortTasks(){this._tasksByParentUuid.clear();for(const t of this._tasks)this._tasksByParentUuid.has(t.parentUuid)?this._tasksByParentUuid.get(t.parentUuid).push(t):this._tasksByParentUuid.set(t.parentUuid,[t]);this._tasksByParentUuid.forEach((t=>t.sort(this._options.taskComparer||i.defaultComparer)))}getShownUuidsRecursively(t=null){const e=this._tasksByParentUuid.get(t)||[],n=[];for(const t of e)n.push(t.uuid),t.expanded&&n.push(...this.getShownUuidsRecursively(t.uuid));return n}}export{u as TsGantt,n as TsGanttOptions,i as TsGanttTask};
